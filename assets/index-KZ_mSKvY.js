(function(){const C=document.createElement("link").relList;if(C&&C.supports&&C.supports("modulepreload"))return;for(const K of document.querySelectorAll('link[rel="modulepreload"]'))b(K);new MutationObserver(K=>{for(const T of K)if(T.type==="childList")for(const I of T.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&b(I)}).observe(document,{childList:!0,subtree:!0});function E(K){const T={};return K.integrity&&(T.integrity=K.integrity),K.referrerPolicy&&(T.referrerPolicy=K.referrerPolicy),K.crossOrigin==="use-credentials"?T.credentials="include":K.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function b(K){if(K.ep)return;K.ep=!0;const T=E(K);fetch(K.href,T)}})();var gi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wi(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}var Zt={exports:{}},_i=Zt.exports,Dr;function ki(){return Dr||(Dr=1,function(x,C){(function(E,b){x.exports=b()})(_i,function(){var E=function(e,t){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])})(e,t)},b=function(){return(b=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function K(e,t,n){for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var T=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:gi,I=Object.keys,N=Array.isArray;function Y(e,t){return typeof t!="object"||I(t).forEach(function(n){e[n]=t[n]}),e}typeof Promise>"u"||T.Promise||(T.Promise=Promise);var J=Object.getPrototypeOf,X={}.hasOwnProperty;function z(e,t){return X.call(e,t)}function ve(e,t){typeof t=="function"&&(t=t(J(e))),(typeof Reflect>"u"?I:Reflect.ownKeys)(t).forEach(function(n){fe(e,n,t[n])})}var de=Object.defineProperty;function fe(e,t,n,r){de(e,t,Y(n&&z(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function we(e){return{from:function(t){return e.prototype=Object.create(t.prototype),fe(e.prototype,"constructor",e),{extend:ve.bind(null,e.prototype)}}}}var tn=Object.getOwnPropertyDescriptor,nn=[].slice;function Qe(e,t,n){return nn.call(e,t,n)}function Et(e,t){return t(e)}function Oe(e){if(!e)throw new Error("Assertion Failed")}function H(e){T.setImmediate?setImmediate(e):setTimeout(e,0)}function re(e,t){if(typeof t=="string"&&z(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var n=[],r=0,i=t.length;r<i;++r){var a=re(e,t[r]);n.push(a)}return n}var o=t.indexOf(".");if(o!==-1){var u=e[t.substr(0,o)];return u==null?void 0:re(u,t.substr(o+1))}}function pe(e,t,n){if(e&&t!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){Oe(typeof n!="string"&&"length"in n);for(var r=0,i=t.length;r<i;++r)pe(e,t[r],n[r])}else{var a,o,u=t.indexOf(".");u!==-1?(a=t.substr(0,u),(o=t.substr(u+1))===""?n===void 0?N(e)&&!isNaN(parseInt(a))?e.splice(a,1):delete e[a]:e[a]=n:pe(u=!(u=e[a])||!z(e,a)?e[a]={}:u,o,n)):n===void 0?N(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function Gn(e){var t,n={};for(t in e)z(e,t)&&(n[t]=e[t]);return n}var Mr=[].concat;function Yn(e){return Mr.apply([],e)}var Ne="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Yn([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return T[e]}),Wn=new Set(Ne.map(function(e){return T[e]})),ct=null;function Re(e){return ct=new WeakMap,e=function t(n){if(!n||typeof n!="object")return n;var r=ct.get(n);if(r)return r;if(N(n)){r=[],ct.set(n,r);for(var i=0,a=n.length;i<a;++i)r.push(t(n[i]))}else if(Wn.has(n.constructor))r=n;else{var o,u=J(n);for(o in r=u===Object.prototype?{}:Object.create(u),ct.set(n,r),n)z(n,o)&&(r[o]=t(n[o]))}return r}(e),ct=null,e}var Lr={}.toString;function rn(e){return Lr.call(e).slice(8,-1)}var an=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Nr=typeof an=="symbol"?function(e){var t;return e!=null&&(t=e[an])&&t.apply(e)}:function(){return null};function Me(e,t){return t=e.indexOf(t),0<=t&&e.splice(t,1),0<=t}var Xe={};function Pe(e){var t,n,r,i;if(arguments.length===1){if(N(e))return e.slice();if(this===Xe&&typeof e=="string")return[e];if(i=Nr(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(e==null)return[e];if(typeof(t=e.length)!="number")return[e];for(n=new Array(t);t--;)n[t]=e[t];return n}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var on=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ht=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],be=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ht),Fr={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function He(e,t){this.name=e,this.message=t}function Jn(e,t){return e+". Errors: "+Object.keys(t).map(function(n){return t[n].toString()}).filter(function(n,r,i){return i.indexOf(n)===r}).join(`
`)}function Ot(e,t,n,r){this.failures=t,this.failedKeys=r,this.successCount=n,this.message=Jn(e,t)}function Ze(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(n){return t[n]}),this.failuresByPos=t,this.message=Jn(e,this.failures)}we(He).from(Error).extend({toString:function(){return this.name+": "+this.message}}),we(Ot).from(He),we(Ze).from(He);var un=be.reduce(function(e,t){return e[t]=t+"Error",e},{}),$r=He,L=be.reduce(function(e,t){var n=t+"Error";function r(i,a){this.name=n,i?typeof i=="string"?(this.message="".concat(i).concat(a?`
 `+a:""),this.inner=a||null):typeof i=="object"&&(this.message="".concat(i.name," ").concat(i.message),this.inner=i):(this.message=Fr[t]||n,this.inner=null)}return we(r).from($r),e[t]=r,e},{});L.Syntax=SyntaxError,L.Type=TypeError,L.Range=RangeError;var Qn=ht.reduce(function(e,t){return e[t+"Error"]=L[t],e},{}),Pt=be.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=L[t]),e},{});function Q(){}function lt(e){return e}function zr(e,t){return e==null||e===lt?t:function(n){return t(e(n))}}function Le(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Vr(e,t){return e===Q?t:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Le(r,this.onsuccess):r),i&&(this.onerror=this.onerror?Le(i,this.onerror):i),a!==void 0?a:n}}function Ur(e,t){return e===Q?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Le(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Le(r,this.onerror):r)}}function Gr(e,t){return e===Q?t:function(n){var r=e.apply(this,arguments);Y(n,r);var i=this.onsuccess,a=this.onerror;return this.onsuccess=null,this.onerror=null,n=t.apply(this,arguments),i&&(this.onsuccess=this.onsuccess?Le(i,this.onsuccess):i),a&&(this.onerror=this.onerror?Le(a,this.onerror):a),r===void 0?n===void 0?void 0:n:Y(r,n)}}function Yr(e,t){return e===Q?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function sn(e,t){return e===Q?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,a=new Array(i);i--;)a[i]=arguments[i];return n.then(function(){return t.apply(r,a)})}return t.apply(this,arguments)}}Pt.ModifyError=Ot,Pt.DexieError=He,Pt.BulkError=Ze;var _e=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Xn(e){_e=e}var ft={},Hn=100,Ne=typeof Promise>"u"?[]:function(){var e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,J(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,J(t),e]}(),ht=Ne[0],be=Ne[1],Ne=Ne[2],be=be&&be.then,Fe=ht&&ht.constructor,cn=!!Ne,dt=function(e,t){pt.push([e,t]),Ct&&(queueMicrotask(Jr),Ct=!1)},ln=!0,Ct=!0,$e=[],At=[],fn=lt,De={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Q,pgp:!1,env:{},finalize:Q},M=De,pt=[],ze=0,St=[];function j(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=M;if(typeof e!="function"){if(e!==ft)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&dn(this,this._value))}this._state=null,this._value=null,++t.ref,function n(r,i){try{i(function(a){if(r._state===null){if(a===r)throw new TypeError("A promise cannot be resolved with itself.");var o=r._lib&&et();a&&typeof a.then=="function"?n(r,function(u,c){a instanceof j?a._then(u,c):a.then(u,c)}):(r._state=!0,r._value=a,er(r)),o&&tt()}},dn.bind(null,r))}catch(a){dn(r,a)}}(this,e)}var hn={get:function(){var e=M,t=Tt;function n(r,i){var a=this,o=!e.global&&(e!==M||t!==Tt),u=o&&!Be(),c=new j(function(f,p){pn(a,new Zn(nr(r,e,o,u),nr(i,e,o,u),f,p,e))});return this._consoleTask&&(c._consoleTask=this._consoleTask),c}return n.prototype=ft,n},set:function(e){fe(this,"then",e&&e.prototype===ft?hn:{get:function(){return e},set:hn.set})}};function Zn(e,t,n,r,i){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=n,this.reject=r,this.psd=i}function dn(e,t){var n,r;At.push(t),e._state===null&&(n=e._lib&&et(),t=fn(t),e._state=!1,e._value=t,r=e,$e.some(function(i){return i._value===r._value})||$e.push(r),er(e),n&&tt())}function er(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)pn(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),ze===0&&(++ze,dt(function(){--ze==0&&yn()},[]))}function pn(e,t){if(e._state!==null){var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++ze,dt(Wr,[n,e,t])}else e._listeners.push(t)}function Wr(e,t,n){try{var r,i=t._value;!t._state&&At.length&&(At=[]),r=_e&&t._consoleTask?t._consoleTask.run(function(){return e(i)}):e(i),t._state||At.indexOf(i)!==-1||function(a){for(var o=$e.length;o;)if($e[--o]._value===a._value)return $e.splice(o,1)}(t),n.resolve(r)}catch(a){n.reject(a)}finally{--ze==0&&yn(),--n.psd.ref||n.psd.finalize()}}function Jr(){Ve(De,function(){et()&&tt()})}function et(){var e=ln;return Ct=ln=!1,e}function tt(){var e,t,n;do for(;0<pt.length;)for(e=pt,pt=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}while(0<pt.length);Ct=ln=!0}function yn(){var e=$e;$e=[],e.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var t=St.slice(0),n=t.length;n;)t[--n]()}function Dt(e){return new j(ft,!1,e)}function ee(e,t){var n=M;return function(){var r=et(),i=M;try{return Te(n,!0),e.apply(this,arguments)}catch(a){t&&t(a)}finally{Te(i,!1),r&&tt()}}}ve(j.prototype,{then:hn,_then:function(e,t){pn(this,new Zn(null,null,e,t,M))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=e,n=arguments[1];return typeof t=="function"?this.then(null,function(r){return(r instanceof t?n:Dt)(r)}):this.then(null,function(r){return(r&&r.name===t?n:Dt)(r)})},finally:function(e){return this.then(function(t){return j.resolve(e()).then(function(){return t})},function(t){return j.resolve(e()).then(function(){return Dt(t)})})},timeout:function(e,t){var n=this;return e<1/0?new j(function(r,i){var a=setTimeout(function(){return i(new L.Timeout(t))},e);n.then(r,i).finally(clearTimeout.bind(null,a))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&fe(j.prototype,Symbol.toStringTag,"Dexie.Promise"),De.env=tr(),ve(j,{all:function(){var e=Pe.apply(null,arguments).map(jt);return new j(function(t,n){e.length===0&&t([]);var r=e.length;e.forEach(function(i,a){return j.resolve(i).then(function(o){e[a]=o,--r||t(e)},n)})})},resolve:function(e){return e instanceof j?e:e&&typeof e.then=="function"?new j(function(t,n){e.then(t,n)}):new j(ft,!0,e)},reject:Dt,race:function(){var e=Pe.apply(null,arguments).map(jt);return new j(function(t,n){e.map(function(r){return j.resolve(r).then(t,n)})})},PSD:{get:function(){return M},set:function(e){return M=e}},totalEchoes:{get:function(){return Tt}},newPSD:Ke,usePSD:Ve,scheduler:{get:function(){return dt},set:function(e){dt=e}},rejectionMapper:{get:function(){return fn},set:function(e){fn=e}},follow:function(e,t){return new j(function(n,r){return Ke(function(i,a){var o=M;o.unhandleds=[],o.onunhandled=a,o.finalize=Le(function(){var u,c=this;u=function(){c.unhandleds.length===0?i():a(c.unhandleds[0])},St.push(function f(){u(),St.splice(St.indexOf(f),1)}),++ze,dt(function(){--ze==0&&yn()},[])},o.finalize),e()},t,n,r)})}}),Fe&&(Fe.allSettled&&fe(j,"allSettled",function(){var e=Pe.apply(null,arguments).map(jt);return new j(function(t){e.length===0&&t([]);var n=e.length,r=new Array(n);e.forEach(function(i,a){return j.resolve(i).then(function(o){return r[a]={status:"fulfilled",value:o}},function(o){return r[a]={status:"rejected",reason:o}}).then(function(){return--n||t(r)})})})}),Fe.any&&typeof AggregateError<"u"&&fe(j,"any",function(){var e=Pe.apply(null,arguments).map(jt);return new j(function(t,n){e.length===0&&n(new AggregateError([]));var r=e.length,i=new Array(r);e.forEach(function(a,o){return j.resolve(a).then(function(u){return t(u)},function(u){i[o]=u,--r||n(new AggregateError(i))})})})}),Fe.withResolvers&&(j.withResolvers=Fe.withResolvers));var ae={awaits:0,echoes:0,id:0},Qr=0,Kt=[],Bt=0,Tt=0,Xr=0;function Ke(e,t,n,r){var i=M,a=Object.create(i);return a.parent=i,a.ref=0,a.global=!1,a.id=++Xr,De.env,a.env=cn?{Promise:j,PromiseProp:{value:j,configurable:!0,writable:!0},all:j.all,race:j.race,allSettled:j.allSettled,any:j.any,resolve:j.resolve,reject:j.reject}:{},t&&Y(a,t),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()},r=Ve(a,e,n,r),a.ref===0&&a.finalize(),r}function nt(){return ae.id||(ae.id=++Qr),++ae.awaits,ae.echoes+=Hn,ae.id}function Be(){return!!ae.awaits&&(--ae.awaits==0&&(ae.id=0),ae.echoes=ae.awaits*Hn,!0)}function jt(e){return ae.echoes&&e&&e.constructor===Fe?(nt(),e.then(function(t){return Be(),t},function(t){return Be(),te(t)})):e}function Hr(){var e=Kt[Kt.length-1];Kt.pop(),Te(e,!1)}function Te(e,t){var n,r=M;(t?!ae.echoes||Bt++&&e===M:!Bt||--Bt&&e===M)||queueMicrotask(t?(function(i){++Tt,ae.echoes&&--ae.echoes!=0||(ae.echoes=ae.awaits=ae.id=0),Kt.push(M),Te(i,!0)}).bind(null,e):Hr),e!==M&&(M=e,r===De&&(De.env=tr()),cn&&(n=De.env.Promise,t=e.env,(r.global||e.global)&&(Object.defineProperty(T,"Promise",t.PromiseProp),n.all=t.all,n.race=t.race,n.resolve=t.resolve,n.reject=t.reject,t.allSettled&&(n.allSettled=t.allSettled),t.any&&(n.any=t.any))))}function tr(){var e=T.Promise;return cn?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(T,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function Ve(e,t,n,r,i){var a=M;try{return Te(e,!0),t(n,r,i)}finally{Te(a,!1)}}function nr(e,t,n,r){return typeof e!="function"?e:function(){var i=M;n&&nt(),Te(t,!0);try{return e.apply(this,arguments)}finally{Te(i,!1),r&&queueMicrotask(Be)}}}function mn(e){Promise===Fe&&ae.echoes===0?Bt===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+be).indexOf("[native code]")===-1&&(nt=Be=Q);var te=j.reject,Ue="￿",Ce="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",rr="String expected.",rt=[],qt="__dbnames",vn="readonly",bn="readwrite";function Ge(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var ir={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function It(e){return typeof e!="string"||/\./.test(e)?function(t){return t}:function(t){return t[e]===void 0&&e in t&&delete(t=Re(t))[e],t}}function ar(){throw L.Type()}function G(e,t){try{var n=or(e),r=or(t);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":return function(i,a){for(var o=i.length,u=a.length,c=o<u?o:u,f=0;f<c;++f)if(i[f]!==a[f])return i[f]<a[f]?-1:1;return o===u?0:o<u?-1:1}(ur(e),ur(t));case"Array":return function(i,a){for(var o=i.length,u=a.length,c=o<u?o:u,f=0;f<c;++f){var p=G(i[f],a[f]);if(p!==0)return p}return o===u?0:o<u?-1:1}(e,t)}}catch{}return NaN}function or(e){var t=typeof e;return t!="object"?t:ArrayBuffer.isView(e)?"binary":(e=rn(e),e==="ArrayBuffer"?"binary":e)}function ur(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var sr=(Z.prototype._trans=function(e,t,n){var r=this._tx||M.trans,i=this.name,a=_e&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function o(f,p,s){if(!s.schema[i])throw new L.NotFound("Table "+i+" not part of transaction");return t(s.idbtrans,s)}var u=et();try{var c=r&&r.db._novip===this.db._novip?r===M.trans?r._promise(e,o,n):Ke(function(){return r._promise(e,o,n)},{trans:r,transless:M.transless||M}):function f(p,s,m,l){if(p.idbdb&&(p._state.openComplete||M.letThrough||p._vip)){var d=p._createTransaction(s,m,p._dbSchema);try{d.create(),p._state.PR1398_maxLoop=3}catch(y){return y.name===un.InvalidState&&p.isOpen()&&0<--p._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),p.close({disableAutoOpen:!1}),p.open().then(function(){return f(p,s,m,l)})):te(y)}return d._promise(s,function(y,h){return Ke(function(){return M.trans=d,l(y,h,d)})}).then(function(y){if(s==="readwrite")try{d.idbtrans.commit()}catch{}return s==="readonly"?y:d._completion.then(function(){return y})})}if(p._state.openComplete)return te(new L.DatabaseClosed(p._state.dbOpenError));if(!p._state.isBeingOpened){if(!p._state.autoOpen)return te(new L.DatabaseClosed);p.open().catch(Q)}return p._state.dbReadyPromise.then(function(){return f(p,s,m,l)})}(this.db,e,[this.name],o);return a&&(c._consoleTask=a,c=c.catch(function(f){return console.trace(f),te(f)})),c}finally{u&&tt()}},Z.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?te(new L.Type("Invalid argument to Table.get()")):this._trans("readonly",function(r){return n.core.get({trans:r,key:e}).then(function(i){return n.hook.reading.fire(i)})}).then(t)},Z.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(N(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=I(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(u){if(u.compound&&t.every(function(f){return 0<=u.keyPath.indexOf(f)})){for(var c=0;c<t.length;++c)if(t.indexOf(u.keyPath[c])===-1)return!1;return!0}return!1}).sort(function(u,c){return u.keyPath.length-c.keyPath.length})[0];if(n&&this.db._maxKey!==Ue){var a=n.keyPath.slice(0,t.length);return this.where(a).equals(a.map(function(c){return e[c]}))}!n&&_e&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var r=this.schema.idxByName;function i(u,c){return G(u,c)===0}var o=t.reduce(function(s,c){var f=s[0],p=s[1],s=r[c],m=e[c];return[f||s,f||!s?Ge(p,s&&s.multi?function(l){return l=re(l,c),N(l)&&l.some(function(d){return i(m,d)})}:function(l){return i(m,re(l,c))}):p]},[null,null]),a=o[0],o=o[1];return a?this.where(a.name).equals(e[a.keyPath]).filter(o):n?this.filter(o):this.where(t).equals("")},Z.prototype.filter=function(e){return this.toCollection().and(e)},Z.prototype.count=function(e){return this.toCollection().count(e)},Z.prototype.offset=function(e){return this.toCollection().offset(e)},Z.prototype.limit=function(e){return this.toCollection().limit(e)},Z.prototype.each=function(e){return this.toCollection().each(e)},Z.prototype.toArray=function(e){return this.toCollection().toArray(e)},Z.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Z.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,N(e)?"[".concat(e.join("+"),"]"):e))},Z.prototype.reverse=function(){return this.toCollection().reverse()},Z.prototype.mapToClass=function(e){var t,n=this.db,r=this.name;function i(){return t!==null&&t.apply(this,arguments)||this}(this.schema.mappedClass=e).prototype instanceof ar&&(function(c,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");function p(){this.constructor=c}E(c,f),c.prototype=f===null?Object.create(f):(p.prototype=f.prototype,new p)}(i,t=e),Object.defineProperty(i.prototype,"db",{get:function(){return n},enumerable:!1,configurable:!0}),i.prototype.table=function(){return r},e=i);for(var a=new Set,o=e.prototype;o;o=J(o))Object.getOwnPropertyNames(o).forEach(function(c){return a.add(c)});function u(c){if(!c)return c;var f,p=Object.create(e.prototype);for(f in c)if(!a.has(f))try{p[f]=c[f]}catch{}return p}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=u,this.hook("reading",u),e},Z.prototype.defineClass=function(){return this.mapToClass(function(e){Y(this,e)})},Z.prototype.add=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,a=r.keyPath,o=e;return a&&i&&(o=It(a)(e)),this._trans("readwrite",function(u){return n.core.mutate({trans:u,type:"add",keys:t!=null?[t]:null,values:[o]})}).then(function(u){return u.numFailures?j.reject(u.failures[0]):u.lastResult}).then(function(u){if(a)try{pe(e,a,u)}catch{}return u})},Z.prototype.update=function(e,t){return typeof e!="object"||N(e)?this.where(":id").equals(e).modify(t):(e=re(e,this.schema.primKey.keyPath),e===void 0?te(new L.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t))},Z.prototype.put=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,a=r.keyPath,o=e;return a&&i&&(o=It(a)(e)),this._trans("readwrite",function(u){return n.core.mutate({trans:u,type:"put",values:[o],keys:t!=null?[t]:null})}).then(function(u){return u.numFailures?j.reject(u.failures[0]):u.lastResult}).then(function(u){if(a)try{pe(e,a,u)}catch{}return u})},Z.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]})}).then(function(n){return n.numFailures?j.reject(n.failures[0]):void 0})},Z.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:ir})}).then(function(t){return t.numFailures?j.reject(t.failures[0]):void 0})},Z.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(n){return t.core.getMany({keys:e,trans:n}).then(function(r){return r.map(function(i){return t.hook.reading.fire(i)})})})},Z.prototype.bulkAdd=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,a=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(o){var f=r.schema.primKey,u=f.auto,f=f.keyPath;if(f&&i)throw new L.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new L.InvalidArgument("Arguments objects and keys must have the same length");var c=e.length,f=f&&u?e.map(It(f)):e;return r.core.mutate({trans:o,type:"add",keys:i,values:f,wantResults:a}).then(function(d){var s=d.numFailures,m=d.results,l=d.lastResult,d=d.failures;if(s===0)return a?m:l;throw new Ze("".concat(r.name,".bulkAdd(): ").concat(s," of ").concat(c," operations failed"),d)})})},Z.prototype.bulkPut=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,a=(n=n||(i?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(o){var f=r.schema.primKey,u=f.auto,f=f.keyPath;if(f&&i)throw new L.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new L.InvalidArgument("Arguments objects and keys must have the same length");var c=e.length,f=f&&u?e.map(It(f)):e;return r.core.mutate({trans:o,type:"put",keys:i,values:f,wantResults:a}).then(function(d){var s=d.numFailures,m=d.results,l=d.lastResult,d=d.failures;if(s===0)return a?m:l;throw new Ze("".concat(r.name,".bulkPut(): ").concat(s," of ").concat(c," operations failed"),d)})})},Z.prototype.bulkUpdate=function(e){var t=this,n=this.core,r=e.map(function(o){return o.key}),i=e.map(function(o){return o.changes}),a=[];return this._trans("readwrite",function(o){return n.getMany({trans:o,keys:r,cache:"clone"}).then(function(u){var c=[],f=[];e.forEach(function(s,m){var l=s.key,d=s.changes,y=u[m];if(y){for(var h=0,v=Object.keys(d);h<v.length;h++){var g=v[h],w=d[g];if(g===t.schema.primKey.keyPath){if(G(w,l)!==0)throw new L.Constraint("Cannot update primary key in bulkUpdate()")}else pe(y,g,w)}a.push(m),c.push(l),f.push(y)}});var p=c.length;return n.mutate({trans:o,type:"put",keys:c,values:f,updates:{keys:r,changeSpecs:i}}).then(function(s){var m=s.numFailures,l=s.failures;if(m===0)return p;for(var d=0,y=Object.keys(l);d<y.length;d++){var h,v=y[d],g=a[Number(v)];g!=null&&(h=l[v],delete l[v],l[g]=h)}throw new Ze("".concat(t.name,".bulkUpdate(): ").concat(m," of ").concat(p," operations failed"),l)})})})},Z.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",function(r){return t.core.mutate({trans:r,type:"delete",keys:e})}).then(function(o){var i=o.numFailures,a=o.lastResult,o=o.failures;if(i===0)return a;throw new Ze("".concat(t.name,".bulkDelete(): ").concat(i," of ").concat(n," operations failed"),o)})},Z);function Z(){}function yt(e){function t(o,u){if(u){for(var c=arguments.length,f=new Array(c-1);--c;)f[c-1]=arguments[c];return n[o].subscribe.apply(null,f),e}if(typeof o=="string")return n[o]}var n={};t.addEventType=a;for(var r=1,i=arguments.length;r<i;++r)a(arguments[r]);return t;function a(o,u,c){if(typeof o!="object"){var f;u=u||Yr;var p={subscribers:[],fire:c=c||Q,subscribe:function(s){p.subscribers.indexOf(s)===-1&&(p.subscribers.push(s),p.fire=u(p.fire,s))},unsubscribe:function(s){p.subscribers=p.subscribers.filter(function(m){return m!==s}),p.fire=p.subscribers.reduce(u,c)}};return n[o]=t[o]=p}I(f=o).forEach(function(s){var m=f[s];if(N(m))a(s,f[s][0],f[s][1]);else{if(m!=="asap")throw new L.InvalidArgument("Invalid event config");var l=a(s,lt,function(){for(var d=arguments.length,y=new Array(d);d--;)y[d]=arguments[d];l.subscribers.forEach(function(h){H(function(){h.apply(null,y)})})})}})}}function mt(e,t){return we(t).from({prototype:e}),t}function it(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function gn(e,t){e.filter=Ge(e.filter,t)}function wn(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return Ge(r(),t())}:t,e.justLimit=n&&!r}function Rt(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new L.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function cr(e,t,n){var r=Rt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:r,range:e.range}})}function Mt(e,t,n,r){var i=e.replayFilter?Ge(e.filter,e.replayFilter()):e.filter;if(e.or){var a={},o=function(u,c,f){var p,s;i&&!i(c,f,function(m){return c.stop(m)},function(m){return c.fail(m)})||((s=""+(p=c.primaryKey))=="[object ArrayBuffer]"&&(s=""+new Uint8Array(p)),z(a,s)||(a[s]=!0,t(u,c,f)))};return Promise.all([e.or._iterate(o,n),lr(cr(e,r,n),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return lr(cr(e,r,n),Ge(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function lr(e,t,n,r){var i=ee(r?function(a,o,u){return n(r(a),o,u)}:n);return e.then(function(a){if(a)return a.start(function(){var o=function(){return a.continue()};t&&!t(a,function(u){return o=u},function(u){a.stop(u),o=Q},function(u){a.fail(u),o=Q})||i(a.value,a,function(u){return o=u}),o()})})}var vt=(fr.prototype.execute=function(e){var t=this["@@propmod"];if(t.add!==void 0){var n=t.add;if(N(n))return K(K([],N(e)?e:[],!0),n).sort();if(typeof n=="number")return(Number(e)||0)+n;if(typeof n=="bigint")try{return BigInt(e)+n}catch{return BigInt(0)+n}throw new TypeError("Invalid term ".concat(n))}if(t.remove!==void 0){var r=t.remove;if(N(r))return N(e)?e.filter(function(i){return!r.includes(i)}).sort():[];if(typeof r=="number")return Number(e)-r;if(typeof r=="bigint")try{return BigInt(e)-r}catch{return BigInt(0)-r}throw new TypeError("Invalid subtrahend ".concat(r))}return n=(n=t.replacePrefix)===null||n===void 0?void 0:n[0],n&&typeof e=="string"&&e.startsWith(n)?t.replacePrefix[1]+e.substring(n.length):e},fr);function fr(e){this["@@propmod"]=e}var Zr=(W.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,te.bind(null,n.error)):n.table._trans("readonly",e).then(t)},W.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,te.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},W.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=Ge(t.algorithm,e)},W.prototype._iterate=function(e,t){return Mt(this._ctx,e,t,this._ctx.table.core)},W.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&Y(n,e),t._ctx=n,t},W.prototype.raw=function(){return this._ctx.valueMapper=null,this},W.prototype.each=function(e){var t=this._ctx;return this._read(function(n){return Mt(t,e,n,t.table.core)})},W.prototype.count=function(e){var t=this;return this._read(function(n){var r=t._ctx,i=r.table.core;if(it(r,!0))return i.count({trans:n,query:{index:Rt(r,i.schema),range:r.range}}).then(function(o){return Math.min(o,r.limit)});var a=0;return Mt(r,function(){return++a,!1},n,i).then(function(){return a})}).then(e)},W.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),r=n[0],i=n.length-1;function a(c,f){return f?a(c[n[f]],f-1):c[r]}var o=this._ctx.dir==="next"?1:-1;function u(c,f){return G(a(c,i),a(f,i))*o}return this.toArray(function(c){return c.sort(u)}).then(t)},W.prototype.toArray=function(e){var t=this;return this._read(function(n){var r=t._ctx;if(r.dir==="next"&&it(r,!0)&&0<r.limit){var i=r.valueMapper,a=Rt(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:a,range:r.range}}).then(function(u){return u=u.result,i?u.map(i):u})}var o=[];return Mt(r,function(u){return o.push(u)},n,r.table.core).then(function(){return o})},e)},W.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,it(t)?wn(t,function(){var n=e;return function(r,i){return n===0||(n===1?--n:i(function(){r.advance(n),n=0}),!1)}}):wn(t,function(){var n=e;return function(){return--n<0}})),this},W.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),wn(this._ctx,function(){var t=e;return function(n,r,i){return--t<=0&&r(i),0<=t}},!0),this},W.prototype.until=function(e,t){return gn(this._ctx,function(n,r,i){return!e(n.value)||(r(i),t)}),this},W.prototype.first=function(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)},W.prototype.last=function(e){return this.reverse().first(e)},W.prototype.filter=function(e){var t;return gn(this._ctx,function(n){return e(n.value)}),(t=this._ctx).isMatch=Ge(t.isMatch,e),this},W.prototype.and=function(e){return this.filter(e)},W.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},W.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},W.prototype.desc=function(){return this.reverse()},W.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,r){e(r.key,r)})},W.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},W.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,r){e(r.primaryKey,r)})},W.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(r,i){n.push(i.key)}).then(function(){return n}).then(e)},W.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir==="next"&&it(t,!0)&&0<t.limit)return this._read(function(r){var i=Rt(t,t.table.core.schema);return t.table.core.query({trans:r,values:!1,limit:t.limit,query:{index:i,range:t.range}})}).then(function(r){return r.result}).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(r,i){n.push(i.primaryKey)}).then(function(){return n}).then(e)},W.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},W.prototype.firstKey=function(e){return this.limit(1).keys(function(t){return t[0]}).then(e)},W.prototype.lastKey=function(e){return this.reverse().firstKey(e)},W.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var t={};return gn(this._ctx,function(i){var r=i.primaryKey.toString(),i=z(t,r);return t[r]=!0,!i}),this},W.prototype.modify=function(e){var t=this,n=this._ctx;return this._write(function(r){var i,a,o;o=typeof e=="function"?e:(i=I(e),a=i.length,function(h){for(var v=!1,g=0;g<a;++g){var w=i[g],k=e[w],O=re(h,w);k instanceof vt?(pe(h,w,k.execute(O)),v=!0):O!==k&&(pe(h,w,k),v=!0)}return v});var u=n.table.core,s=u.schema.primaryKey,c=s.outbound,f=s.extractKey,p=200,s=t.db._options.modifyChunkSize;s&&(p=typeof s=="object"?s[u.name]||s["*"]||200:s);function m(h,w){var g=w.failures,w=w.numFailures;d+=h-w;for(var k=0,O=I(g);k<O.length;k++){var D=O[k];l.push(g[D])}}var l=[],d=0,y=[];return t.clone().primaryKeys().then(function(h){function v(w){var k=Math.min(p,h.length-w);return u.getMany({trans:r,keys:h.slice(w,w+k),cache:"immutable"}).then(function(O){for(var D=[],P=[],A=c?[]:null,B=[],S=0;S<k;++S){var q=O[S],$={value:Re(q),primKey:h[w+S]};o.call($,$.value,$)!==!1&&($.value==null?B.push(h[w+S]):c||G(f(q),f($.value))===0?(P.push($.value),c&&A.push(h[w+S])):(B.push(h[w+S]),D.push($.value)))}return Promise.resolve(0<D.length&&u.mutate({trans:r,type:"add",values:D}).then(function(V){for(var U in V.failures)B.splice(parseInt(U),1);m(D.length,V)})).then(function(){return(0<P.length||g&&typeof e=="object")&&u.mutate({trans:r,type:"put",keys:A,values:P,criteria:g,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<w}).then(function(V){return m(P.length,V)})}).then(function(){return(0<B.length||g&&e===_n)&&u.mutate({trans:r,type:"delete",keys:B,criteria:g,isAdditionalChunk:0<w}).then(function(V){return m(B.length,V)})}).then(function(){return h.length>w+k&&v(w+p)})})}var g=it(n)&&n.limit===1/0&&(typeof e!="function"||e===_n)&&{index:n.index,range:n.range};return v(0).then(function(){if(0<l.length)throw new Ot("Error modifying one or more objects",l,d,y);return h.length})})})},W.prototype.delete=function(){var e=this._ctx,t=e.range;return it(e)&&(e.isPrimKey||t.type===3)?this._write(function(n){var r=e.table.core.schema.primaryKey,i=t;return e.table.core.count({trans:n,query:{index:r,range:i}}).then(function(a){return e.table.core.mutate({trans:n,type:"deleteRange",range:i}).then(function(o){var u=o.failures;if(o.lastResult,o.results,o=o.numFailures,o)throw new Ot("Could not delete some values",Object.keys(u).map(function(c){return u[c]}),a-o);return a-o})})}):this.modify(_n)},W);function W(){}var _n=function(e,t){return t.value=null};function ei(e,t){return e<t?-1:e===t?0:1}function ti(e,t){return t<e?-1:e===t?0:1}function ye(e,t,n){return e=e instanceof dr?new e.Collection(e):e,e._ctx.error=new(n||TypeError)(t),e}function at(e){return new e.Collection(e,function(){return hr("")}).limit(0)}function Lt(e,t,n,r){var i,a,o,u,c,f,p,s=n.length;if(!n.every(function(d){return typeof d=="string"}))return ye(e,rr);function m(d){i=d==="next"?function(h){return h.toUpperCase()}:function(h){return h.toLowerCase()},a=d==="next"?function(h){return h.toLowerCase()}:function(h){return h.toUpperCase()},o=d==="next"?ei:ti;var y=n.map(function(h){return{lower:a(h),upper:i(h)}}).sort(function(h,v){return o(h.lower,v.lower)});u=y.map(function(h){return h.upper}),c=y.map(function(h){return h.lower}),p=(f=d)==="next"?"":r}m("next"),e=new e.Collection(e,function(){return je(u[0],c[s-1]+r)}),e._ondirectionchange=function(d){m(d)};var l=0;return e._addAlgorithm(function(d,y,h){var v=d.key;if(typeof v!="string")return!1;var g=a(v);if(t(g,c,l))return!0;for(var w=null,k=l;k<s;++k){var O=function(D,P,A,B,S,q){for(var $=Math.min(D.length,B.length),V=-1,U=0;U<$;++U){var me=P[U];if(me!==B[U])return S(D[U],A[U])<0?D.substr(0,U)+A[U]+A.substr(U+1):S(D[U],B[U])<0?D.substr(0,U)+B[U]+A.substr(U+1):0<=V?D.substr(0,V)+P[V]+A.substr(V+1):null;S(D[U],me)<0&&(V=U)}return $<B.length&&q==="next"?D+A.substr(D.length):$<D.length&&q==="prev"?D.substr(0,A.length):V<0?null:D.substr(0,V)+B[V]+A.substr(V+1)}(v,g,u[k],c[k],o,f);O===null&&w===null?l=k+1:(w===null||0<o(w,O))&&(w=O)}return y(w!==null?function(){d.continue(w+p)}:h),!1}),e}function je(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function hr(e){return{type:1,lower:e,upper:e}}var dr=(Object.defineProperty(oe.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),oe.prototype.between=function(e,t,n,r){n=n!==!1,r=r===!0;try{return 0<this._cmp(e,t)||this._cmp(e,t)===0&&(n||r)&&(!n||!r)?at(this):new this.Collection(this,function(){return je(e,t,!n,!r)})}catch{return ye(this,Ce)}},oe.prototype.equals=function(e){return e==null?ye(this,Ce):new this.Collection(this,function(){return hr(e)})},oe.prototype.above=function(e){return e==null?ye(this,Ce):new this.Collection(this,function(){return je(e,void 0,!0)})},oe.prototype.aboveOrEqual=function(e){return e==null?ye(this,Ce):new this.Collection(this,function(){return je(e,void 0,!1)})},oe.prototype.below=function(e){return e==null?ye(this,Ce):new this.Collection(this,function(){return je(void 0,e,!1,!0)})},oe.prototype.belowOrEqual=function(e){return e==null?ye(this,Ce):new this.Collection(this,function(){return je(void 0,e)})},oe.prototype.startsWith=function(e){return typeof e!="string"?ye(this,rr):this.between(e,e+Ue,!0,!0)},oe.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):Lt(this,function(t,n){return t.indexOf(n[0])===0},[e],Ue)},oe.prototype.equalsIgnoreCase=function(e){return Lt(this,function(t,n){return t===n[0]},[e],"")},oe.prototype.anyOfIgnoreCase=function(){var e=Pe.apply(Xe,arguments);return e.length===0?at(this):Lt(this,function(t,n){return n.indexOf(t)!==-1},e,"")},oe.prototype.startsWithAnyOfIgnoreCase=function(){var e=Pe.apply(Xe,arguments);return e.length===0?at(this):Lt(this,function(t,n){return n.some(function(r){return t.indexOf(r)===0})},e,Ue)},oe.prototype.anyOf=function(){var e=this,t=Pe.apply(Xe,arguments),n=this._cmp;try{t.sort(n)}catch{return ye(this,Ce)}if(t.length===0)return at(this);var r=new this.Collection(this,function(){return je(t[0],t[t.length-1])});r._ondirectionchange=function(a){n=a==="next"?e._ascending:e._descending,t.sort(n)};var i=0;return r._addAlgorithm(function(a,o,u){for(var c=a.key;0<n(c,t[i]);)if(++i===t.length)return o(u),!1;return n(c,t[i])===0||(o(function(){a.continue(t[i])}),!1)}),r},oe.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},oe.prototype.noneOf=function(){var e=Pe.apply(Xe,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return ye(this,Ce)}var t=e.reduce(function(n,r){return n?n.concat([[n[n.length-1][1],r]]):[[-1/0,r]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},oe.prototype.inAnyRange=function(v,t){var n=this,r=this._cmp,i=this._ascending,a=this._descending,o=this._min,u=this._max;if(v.length===0)return at(this);if(!v.every(function(g){return g[0]!==void 0&&g[1]!==void 0&&i(g[0],g[1])<=0}))return ye(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",L.InvalidArgument);var c=!t||t.includeLowers!==!1,f=t&&t.includeUppers===!0,p,s=i;function m(g,w){return s(g[0],w[0])}try{(p=v.reduce(function(g,w){for(var k=0,O=g.length;k<O;++k){var D=g[k];if(r(w[0],D[1])<0&&0<r(w[1],D[0])){D[0]=o(D[0],w[0]),D[1]=u(D[1],w[1]);break}}return k===O&&g.push(w),g},[])).sort(m)}catch{return ye(this,Ce)}var l=0,d=f?function(g){return 0<i(g,p[l][1])}:function(g){return 0<=i(g,p[l][1])},y=c?function(g){return 0<a(g,p[l][0])}:function(g){return 0<=a(g,p[l][0])},h=d,v=new this.Collection(this,function(){return je(p[0][0],p[p.length-1][1],!c,!f)});return v._ondirectionchange=function(g){s=g==="next"?(h=d,i):(h=y,a),p.sort(m)},v._addAlgorithm(function(g,w,k){for(var O,D=g.key;h(D);)if(++l===p.length)return w(k),!1;return!d(O=D)&&!y(O)||(n._cmp(D,p[l][1])===0||n._cmp(D,p[l][0])===0||w(function(){s===i?g.continue(p[l][0]):g.continue(p[l][1])}),!1)}),v},oe.prototype.startsWithAnyOf=function(){var e=Pe.apply(Xe,arguments);return e.every(function(t){return typeof t=="string"})?e.length===0?at(this):this.inAnyRange(e.map(function(t){return[t,t+Ue]})):ye(this,"startsWithAnyOf() only works with strings")},oe);function oe(){}function ke(e){return ee(function(t){return bt(t),e(t.target.error),!1})}function bt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var gt="storagemutated",kn="x-storagemutated-1",qe=yt(null,gt),ni=(xe.prototype._lock=function(){return Oe(!M.global),++this._reculock,this._reculock!==1||M.global||(M.lockOwnerFor=this),this},xe.prototype._unlock=function(){if(Oe(!M.global),--this._reculock==0)for(M.global||(M.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{Ve(e[1],e[0])}catch{}}return this},xe.prototype._locked=function(){return this._reculock&&M.lockOwnerFor!==this},xe.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(Oe(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new L.DatabaseClosed(r);case"MissingAPIError":throw new L.MissingAPI(r.message,r);default:throw new L.OpenFailed(r)}if(!this.active)throw new L.TransactionInactive;return Oe(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=ee(function(i){bt(i),t._reject(e.error)}),e.onabort=ee(function(i){bt(i),t.active&&t._reject(new L.Abort(e.error)),t.active=!1,t.on("abort").fire(i)}),e.oncomplete=ee(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&qe.storagemutated.fire(e.mutatedParts)}),this},xe.prototype._promise=function(e,t,n){var r=this;if(e==="readwrite"&&this.mode!=="readwrite")return te(new L.ReadOnly("Transaction is readonly"));if(!this.active)return te(new L.TransactionInactive);if(this._locked())return new j(function(a,o){r._blockedFuncs.push([function(){r._promise(e,t,n).then(a,o)},M])});if(n)return Ke(function(){var a=new j(function(o,u){r._lock();var c=t(o,u,r);c&&c.then&&c.then(o,u)});return a.finally(function(){return r._unlock()}),a._lib=!0,a});var i=new j(function(a,o){var u=t(a,o,r);u&&u.then&&u.then(a,o)});return i._lib=!0,i},xe.prototype._root=function(){return this.parent?this.parent._root():this},xe.prototype.waitFor=function(e){var t,n=this._root(),r=j.resolve(e);n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return r}):(n._waitingFor=r,n._waitingQueue=[],t=n.idbtrans.objectStore(n.storeNames[0]),function a(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(t.get(-1/0).onsuccess=a)}());var i=n._waitingFor;return new j(function(a,o){r.then(function(u){return n._waitingQueue.push(ee(a.bind(null,u)))},function(u){return n._waitingQueue.push(ee(o.bind(null,u)))}).finally(function(){n._waitingFor===i&&(n._waitingFor=null)})})},xe.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new L.Abort))},xe.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(z(t,e))return t[e];var n=this.schema[e];if(!n)throw new L.NotFound("Table "+e+" not part of transaction");return n=new this.db.Table(e,n,this),n.core=this.db.core.table(e),t[e]=n},xe);function xe(){}function xn(e,t,n,r,i,a,o){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:a,src:(n&&!o?"&":"")+(r?"*":"")+(i?"++":"")+pr(t)}}function pr(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function En(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:(r=function(i){return[i.name,i]},n.reduce(function(i,a,o){return o=r(a,o),o&&(i[o[0]]=o[1]),i},{}))};var r}var wt=function(e){try{return e.only([[]]),wt=function(){return[[]]},[[]]}catch{return wt=function(){return Ue},Ue}};function On(e){return e==null?function(){}:typeof e=="string"?(t=e).split(".").length===1?function(n){return n[t]}:function(n){return re(n,t)}:function(n){return re(n,e)};var t}function yr(e){return[].slice.call(e)}var ri=0;function _t(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function ii(e,t,c){function r(h){if(h.type===3)return null;if(h.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var l=h.lower,d=h.upper,y=h.lowerOpen,h=h.upperOpen;return l===void 0?d===void 0?null:t.upperBound(d,!!h):d===void 0?t.lowerBound(l,!!y):t.bound(l,d,!!y,!!h)}function i(m){var l,d=m.name;return{name:d,schema:m,mutate:function(y){var h=y.trans,v=y.type,g=y.keys,w=y.values,k=y.range;return new Promise(function(O,D){O=ee(O);var P=h.objectStore(d),A=P.keyPath==null,B=v==="put"||v==="add";if(!B&&v!=="delete"&&v!=="deleteRange")throw new Error("Invalid operation type: "+v);var S,q=(g||w||{length:1}).length;if(g&&w&&g.length!==w.length)throw new Error("Given keys array must have same length as given values array.");if(q===0)return O({numFailures:0,failures:{},results:[],lastResult:void 0});function $(he){++me,bt(he)}var V=[],U=[],me=0;if(v==="deleteRange"){if(k.type===4)return O({numFailures:me,failures:U,results:[],lastResult:void 0});k.type===3?V.push(S=P.clear()):V.push(S=P.delete(r(k)))}else{var A=B?A?[w,g]:[w,null]:[g,null],F=A[0],ce=A[1];if(B)for(var le=0;le<q;++le)V.push(S=ce&&ce[le]!==void 0?P[v](F[le],ce[le]):P[v](F[le])),S.onerror=$;else for(le=0;le<q;++le)V.push(S=P[v](F[le])),S.onerror=$}function Ht(he){he=he.target.result,V.forEach(function(Je,zn){return Je.error!=null&&(U[zn]=Je.error)}),O({numFailures:me,failures:U,results:v==="delete"?g:V.map(function(Je){return Je.result}),lastResult:he})}S.onerror=function(he){$(he),Ht(he)},S.onsuccess=Ht})},getMany:function(y){var h=y.trans,v=y.keys;return new Promise(function(g,w){g=ee(g);for(var k,O=h.objectStore(d),D=v.length,P=new Array(D),A=0,B=0,S=function(V){V=V.target,P[V._pos]=V.result,++B===A&&g(P)},q=ke(w),$=0;$<D;++$)v[$]!=null&&((k=O.get(v[$]))._pos=$,k.onsuccess=S,k.onerror=q,++A);A===0&&g(P)})},get:function(y){var h=y.trans,v=y.key;return new Promise(function(g,w){g=ee(g);var k=h.objectStore(d).get(v);k.onsuccess=function(O){return g(O.target.result)},k.onerror=ke(w)})},query:(l=f,function(y){return new Promise(function(h,v){h=ee(h);var g,w,k,A=y.trans,O=y.values,D=y.limit,S=y.query,P=D===1/0?void 0:D,B=S.index,S=S.range,A=A.objectStore(d),B=B.isPrimaryKey?A:A.index(B.name),S=r(S);if(D===0)return h({result:[]});l?((P=O?B.getAll(S,P):B.getAllKeys(S,P)).onsuccess=function(q){return h({result:q.target.result})},P.onerror=ke(v)):(g=0,w=!O&&"openKeyCursor"in B?B.openKeyCursor(S):B.openCursor(S),k=[],w.onsuccess=function(q){var $=w.result;return $?(k.push(O?$.value:$.primaryKey),++g===D?h({result:k}):void $.continue()):h({result:k})},w.onerror=ke(v))})}),openCursor:function(y){var h=y.trans,v=y.values,g=y.query,w=y.reverse,k=y.unique;return new Promise(function(O,D){O=ee(O);var B=g.index,P=g.range,A=h.objectStore(d),A=B.isPrimaryKey?A:A.index(B.name),B=w?k?"prevunique":"prev":k?"nextunique":"next",S=!v&&"openKeyCursor"in A?A.openKeyCursor(r(P),B):A.openCursor(r(P),B);S.onerror=ke(D),S.onsuccess=ee(function(q){var $,V,U,me,F=S.result;F?(F.___id=++ri,F.done=!1,$=F.continue.bind(F),V=(V=F.continuePrimaryKey)&&V.bind(F),U=F.advance.bind(F),me=function(){throw new Error("Cursor not stopped")},F.trans=h,F.stop=F.continue=F.continuePrimaryKey=F.advance=function(){throw new Error("Cursor not started")},F.fail=ee(D),F.next=function(){var ce=this,le=1;return this.start(function(){return le--?ce.continue():ce.stop()}).then(function(){return ce})},F.start=function(ce){function le(){if(S.result)try{ce()}catch(he){F.fail(he)}else F.done=!0,F.start=function(){throw new Error("Cursor behind last entry")},F.stop()}var Ht=new Promise(function(he,Je){he=ee(he),S.onerror=ke(Je),F.fail=Je,F.stop=function(zn){F.stop=F.continue=F.continuePrimaryKey=F.advance=me,he(zn)}});return S.onsuccess=ee(function(he){S.onsuccess=le,le()}),F.continue=$,F.continuePrimaryKey=V,F.advance=U,le(),Ht},O(F)):O(null)},D)})},count:function(y){var h=y.query,v=y.trans,g=h.index,w=h.range;return new Promise(function(k,O){var D=v.objectStore(d),P=g.isPrimaryKey?D:D.index(g.name),D=r(w),P=D?P.count(D):P.count();P.onsuccess=ee(function(A){return k(A.target.result)}),P.onerror=ke(O)})}}}var a,o,u,p=(o=c,u=yr((a=e).objectStoreNames),{schema:{name:a.name,tables:u.map(function(m){return o.objectStore(m)}).map(function(m){var l=m.keyPath,h=m.autoIncrement,d=N(l),y={},h={name:m.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:l==null,compound:d,keyPath:l,autoIncrement:h,unique:!0,extractKey:On(l)},indexes:yr(m.indexNames).map(function(v){return m.index(v)}).map(function(k){var g=k.name,w=k.unique,O=k.multiEntry,k=k.keyPath,O={name:g,compound:N(k),keyPath:k,unique:w,multiEntry:O,extractKey:On(k)};return y[_t(k)]=O}),getIndexByKeyPath:function(v){return y[_t(v)]}};return y[":id"]=h.primaryKey,l!=null&&(y[_t(l)]=h.primaryKey),h})},hasGetAll:0<u.length&&"getAll"in o.objectStore(u[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),c=p.schema,f=p.hasGetAll,p=c.tables.map(i),s={};return p.forEach(function(m){return s[m.name]=m}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(m){if(!s[m])throw new Error("Table '".concat(m,"' not found"));return s[m]},MIN_KEY:-1/0,MAX_KEY:wt(t),schema:c}}function ai(e,t,n,r){var i=n.IDBKeyRange;return n.indexedDB,{dbcore:(r=ii(t,i,r),e.dbcore.reduce(function(a,o){return o=o.create,b(b({},a),o(a))},r))}}function Nt(e,r){var n=r.db,r=ai(e._middlewares,n,e._deps,r);e.core=r.dbcore,e.tables.forEach(function(i){var a=i.name;e.core.schema.tables.some(function(o){return o.name===a})&&(i.core=e.core.table(a),e[a]instanceof e.Table&&(e[a].core=i.core))})}function Ft(e,t,n,r){n.forEach(function(i){var a=r[i];t.forEach(function(o){var u=function c(f,p){return tn(f,p)||(f=J(f))&&c(f,p)}(o,i);(!u||"value"in u&&u.value===void 0)&&(o===e.Transaction.prototype||o instanceof e.Transaction?fe(o,i,{get:function(){return this.table(i)},set:function(c){de(this,i,{value:c,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new e.Table(i,a))})})}function Pn(e,t){t.forEach(function(n){for(var r in n)n[r]instanceof e.Table&&delete n[r]})}function oi(e,t){return e._cfg.version-t._cfg.version}function ui(e,t,n,r){var i=e._dbSchema;n.objectStoreNames.contains("$meta")&&!i.$meta&&(i.$meta=En("$meta",vr("")[0],[]),e._storeNames.push("$meta"));var a=e._createTransaction("readwrite",e._storeNames,i);a.create(n),a._completion.catch(r);var o=a._reject.bind(a),u=M.transless||M;Ke(function(){return M.trans=a,M.transless=u,t!==0?(Nt(e,n),f=t,((c=a).storeNames.includes("$meta")?c.table("$meta").get("version").then(function(p){return p??f}):j.resolve(f)).then(function(p){return m=p,l=a,d=n,y=[],p=(s=e)._versions,h=s._dbSchema=zt(0,s.idbdb,d),(p=p.filter(function(v){return v._cfg.version>=m})).length!==0?(p.forEach(function(v){y.push(function(){var g=h,w=v._cfg.dbschema;Vt(s,g,d),Vt(s,w,d),h=s._dbSchema=w;var k=Cn(g,w);k.add.forEach(function(B){An(d,B[0],B[1].primKey,B[1].indexes)}),k.change.forEach(function(B){if(B.recreate)throw new L.Upgrade("Not yet support for changing primary key");var S=d.objectStore(B.name);B.add.forEach(function(q){return $t(S,q)}),B.change.forEach(function(q){S.deleteIndex(q.name),$t(S,q)}),B.del.forEach(function(q){return S.deleteIndex(q)})});var O=v._cfg.contentUpgrade;if(O&&v._cfg.version>m){Nt(s,d),l._memoizedTables={};var D=Gn(w);k.del.forEach(function(B){D[B]=g[B]}),Pn(s,[s.Transaction.prototype]),Ft(s,[s.Transaction.prototype],I(D),D),l.schema=D;var P,A=on(O);return A&&nt(),k=j.follow(function(){var B;(P=O(l))&&A&&(B=Be.bind(null,null),P.then(B,B))}),P&&typeof P.then=="function"?j.resolve(P):k.then(function(){return P})}}),y.push(function(g){var w,k,O=v._cfg.dbschema;w=O,k=g,[].slice.call(k.db.objectStoreNames).forEach(function(D){return w[D]==null&&k.db.deleteObjectStore(D)}),Pn(s,[s.Transaction.prototype]),Ft(s,[s.Transaction.prototype],s._storeNames,s._dbSchema),l.schema=s._dbSchema}),y.push(function(g){s.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(s.idbdb.version/10)===v._cfg.version?(s.idbdb.deleteObjectStore("$meta"),delete s._dbSchema.$meta,s._storeNames=s._storeNames.filter(function(w){return w!=="$meta"})):g.objectStore("$meta").put(v._cfg.version,"version"))})}),function v(){return y.length?j.resolve(y.shift()(l.idbtrans)).then(v):j.resolve()}().then(function(){mr(h,d)})):j.resolve();var s,m,l,d,y,h}).catch(o)):(I(i).forEach(function(p){An(n,p,i[p].primKey,i[p].indexes)}),Nt(e,n),void j.follow(function(){return e.on.populate.fire(a)}).catch(o));var c,f})}function si(e,t){mr(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=zt(0,e.idbdb,t);Vt(e,e._dbSchema,t);for(var r=0,i=Cn(n,e._dbSchema).change;r<i.length;r++){var a=function(o){if(o.change.length||o.recreate)return console.warn("Unable to patch indexes of table ".concat(o.name," because it has changes on the type of index or primary key.")),{value:void 0};var u=t.objectStore(o.name);o.add.forEach(function(c){_e&&console.debug("Dexie upgrade patch: Creating missing index ".concat(o.name,".").concat(c.src)),$t(u,c)})}(i[r]);if(typeof a=="object")return a.value}}function Cn(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var i=e[n],a=t[n];if(i){var o={name:n,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||i.primKey.auto!==a.primKey.auto)o.recreate=!0,r.change.push(o);else{var u=i.idxByName,c=a.idxByName,f=void 0;for(f in u)c[f]||o.del.push(f);for(f in c){var p=u[f],s=c[f];p?p.src!==s.src&&o.change.push(s):o.add.push(s)}(0<o.del.length||0<o.add.length||0<o.change.length)&&r.change.push(o)}}else r.add.push([n,a])}return r}function An(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(a){return $t(i,a)}),i}function mr(e,t){I(e).forEach(function(n){t.db.objectStoreNames.contains(n)||(_e&&console.debug("Dexie: Creating missing table",n),An(t,n,e[n].primKey,e[n].indexes))})}function $t(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function zt(e,t,n){var r={};return Qe(t.objectStoreNames,0).forEach(function(i){for(var a=n.objectStore(i),o=xn(pr(f=a.keyPath),f||"",!0,!1,!!a.autoIncrement,f&&typeof f!="string",!0),u=[],c=0;c<a.indexNames.length;++c){var p=a.index(a.indexNames[c]),f=p.keyPath,p=xn(p.name,f,!!p.unique,!!p.multiEntry,!1,f&&typeof f!="string",!1);u.push(p)}r[i]=En(i,o,u)}),r}function Vt(e,t,n){for(var r=n.db.objectStoreNames,i=0;i<r.length;++i){var a=r[i],o=n.objectStore(a);e._hasGetAll="getAll"in o;for(var u=0;u<o.indexNames.length;++u){var c=o.indexNames[u],f=o.index(c).keyPath,p=typeof f=="string"?f:"["+Qe(f).join("+")+"]";!t[a]||(f=t[a].idxByName[p])&&(f.name=c,delete t[a].idxByName[p],t[a].idxByName[c]=f)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&T.WorkerGlobalScope&&T instanceof T.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function vr(e){return e.split(",").map(function(t,n){var r=(t=t.trim()).replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return xn(r,i||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),N(i),n===0)})}var ci=(Ut.prototype._parseStoresSpec=function(e,t){I(e).forEach(function(n){if(e[n]!==null){var r=vr(e[n]),i=r.shift();if(i.unique=!0,i.multi)throw new L.Schema("Primary key cannot be multi-valued");r.forEach(function(a){if(a.auto)throw new L.Schema("Only primary key can be marked as autoIncrement (++)");if(!a.keyPath)throw new L.Schema("Index must have a name and cannot be an empty string")}),t[n]=En(n,i,r)}})},Ut.prototype.stores=function(n){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?Y(this._cfg.storesSource,n):n;var n=t._versions,r={},i={};return n.forEach(function(a){Y(r,a._cfg.storesSource),i=a._cfg.dbschema={},a._parseStoresSpec(r,i)}),t._dbSchema=i,Pn(t,[t._allTables,t,t.Transaction.prototype]),Ft(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],I(i),i),t._storeNames=I(i),this},Ut.prototype.upgrade=function(e){return this._cfg.contentUpgrade=sn(this._cfg.contentUpgrade||Q,e),this},Ut);function Ut(){}function Sn(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Ae(qt,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function Dn(e){return e&&typeof e.databases=="function"}function Kn(e){return Ke(function(){return M.letThrough=!0,e()})}function Bn(e){return!("from"in e)}var se=function(e,t){if(!this){var n=new se;return e&&"d"in e&&Y(n,e),n}Y(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function kt(e,t,n){var r=G(t,n);if(!isNaN(r)){if(0<r)throw RangeError();if(Bn(e))return Y(e,{from:t,to:n,d:1});var i=e.l,r=e.r;if(G(n,e.from)<0)return i?kt(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},gr(e);if(0<G(t,e.to))return r?kt(r,t,n):e.r={from:t,to:n,d:1,l:null,r:null},gr(e);G(t,e.from)<0&&(e.from=t,e.l=null,e.d=r?r.d+1:1),0<G(n,e.to)&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1),n=!e.r,i&&!e.l&&xt(e,i),r&&n&&xt(e,r)}}function xt(e,t){Bn(t)||function n(r,c){var a=c.from,o=c.to,u=c.l,c=c.r;kt(r,a,o),u&&n(r,u),c&&n(r,c)}(e,t)}function br(e,t){var n=Gt(t),r=n.next();if(r.done)return!1;for(var i=r.value,a=Gt(e),o=a.next(i.from),u=o.value;!r.done&&!o.done;){if(G(u.from,i.to)<=0&&0<=G(u.to,i.from))return!0;G(i.from,u.from)<0?i=(r=n.next(u.from)).value:u=(o=a.next(i.from)).value}return!1}function Gt(e){var t=Bn(e)?null:{s:0,n:e};return{next:function(n){for(var r=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&G(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||G(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function gr(e){var t,n,r=(((t=e.r)===null||t===void 0?void 0:t.d)||0)-(((n=e.l)===null||n===void 0?void 0:n.d)||0),i=1<r?"r":r<-1?"l":"";i&&(t=i=="r"?"l":"r",n=b({},e),r=e[i],e.from=r.from,e.to=r.to,e[i]=r[i],n[i]=r[t],(e[t]=n).d=wr(n)),e.d=wr(e)}function wr(n){var t=n.r,n=n.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}function Yt(e,t){return I(t).forEach(function(n){e[n]?xt(e[n],t[n]):e[n]=function r(i){var a,o,u={};for(a in i)z(i,a)&&(o=i[a],u[a]=!o||typeof o!="object"||Wn.has(o.constructor)?o:r(o));return u}(t[n])}),e}function Tn(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&br(t[n],e[n])})}ve(se.prototype,((be={add:function(e){return xt(this,e),this},addKey:function(e){return kt(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(n){return kt(t,n,n)}),this},hasKey:function(e){var t=Gt(this).next(e).value;return t&&G(t.from,e)<=0&&0<=G(t.to,e)}})[an]=function(){return Gt(this)},be));var Ye={},jn={},qn=!1;function Wt(e){Yt(jn,e),qn||(qn=!0,setTimeout(function(){qn=!1,In(jn,!(jn={}))},0))}function In(e,t){t===void 0&&(t=!1);var n=new Set;if(e.all)for(var r=0,i=Object.values(Ye);r<i.length;r++)_r(o=i[r],e,n,t);else for(var a in e){var o,u=/^idb\:\/\/(.*)\/(.*)\//.exec(a);u&&(a=u[1],u=u[2],(o=Ye["idb://".concat(a,"/").concat(u)])&&_r(o,e,n,t))}n.forEach(function(c){return c()})}function _r(e,t,n,r){for(var i=[],a=0,o=Object.entries(e.queries.query);a<o.length;a++){for(var u=o[a],c=u[0],f=[],p=0,s=u[1];p<s.length;p++){var m=s[p];Tn(t,m.obsSet)?m.subscribers.forEach(function(h){return n.add(h)}):r&&f.push(m)}r&&i.push([c,f])}if(r)for(var l=0,d=i;l<d.length;l++){var y=d[l],c=y[0],f=y[1];e.queries.query[c]=f}}function li(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?te(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller,i=Math.round(10*e.verno),a=!1;function o(){if(t.openCanceller!==r)throw new L.DatabaseClosed("db.open() was cancelled")}function u(){return new j(function(m,l){if(o(),!n)throw new L.MissingAPI;var d=e.name,y=t.autoSchema||!i?n.open(d):n.open(d,i);if(!y)throw new L.MissingAPI;y.onerror=ke(l),y.onblocked=ee(e._fireOnBlocked),y.onupgradeneeded=ee(function(h){var v;p=y.transaction,t.autoSchema&&!e._options.allowEmptyDB?(y.onerror=bt,p.abort(),y.result.close(),(v=n.deleteDatabase(d)).onsuccess=v.onerror=ee(function(){l(new L.NoSuchDatabase("Database ".concat(d," doesnt exist")))})):(p.onerror=ke(l),h=h.oldVersion>Math.pow(2,62)?0:h.oldVersion,s=h<1,e.idbdb=y.result,a&&si(e,p),ui(e,h/10,p,l))},l),y.onsuccess=ee(function(){p=null;var h,v,g,w,k,O=e.idbdb=y.result,D=Qe(O.objectStoreNames);if(0<D.length)try{var P=O.transaction((w=D).length===1?w[0]:w,"readonly");if(t.autoSchema)v=O,g=P,(h=e).verno=v.version/10,g=h._dbSchema=zt(0,v,g),h._storeNames=Qe(v.objectStoreNames,0),Ft(h,[h._allTables],I(g),g);else if(Vt(e,e._dbSchema,P),((k=Cn(zt(0,(k=e).idbdb,P),k._dbSchema)).add.length||k.change.some(function(A){return A.add.length||A.change.length}))&&!a)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),O.close(),i=O.version+1,a=!0,m(u());Nt(e,P)}catch{}rt.push(e),O.onversionchange=ee(function(A){t.vcFired=!0,e.on("versionchange").fire(A)}),O.onclose=ee(function(A){e.on("close").fire(A)}),s&&(k=e._deps,P=d,O=k.indexedDB,k=k.IDBKeyRange,Dn(O)||P===qt||Sn(O,k).put({name:P}).catch(Q)),m()},l)}).catch(function(m){switch(m?.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),u();break;case"VersionError":if(0<i)return i=0,u()}return j.reject(m)})}var c,f=t.dbReadyResolve,p=null,s=!1;return j.race([r,(typeof navigator>"u"?j.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(m){function l(){return indexedDB.databases().finally(m)}c=setInterval(l,100),l()}).finally(function(){return clearInterval(c)}):Promise.resolve()).then(u)]).then(function(){return o(),t.onReadyBeingFired=[],j.resolve(Kn(function(){return e.on.ready.fire(e.vip)})).then(function m(){if(0<t.onReadyBeingFired.length){var l=t.onReadyBeingFired.reduce(sn,Q);return t.onReadyBeingFired=[],j.resolve(Kn(function(){return l(e.vip)})).then(m)}})}).finally(function(){t.openCanceller===r&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(m){t.dbOpenError=m;try{p&&p.abort()}catch{}return r===t.openCanceller&&e._close(),te(m)}).finally(function(){t.openComplete=!0,f()}).then(function(){var m;return s&&(m={},e.tables.forEach(function(l){l.schema.indexes.forEach(function(d){d.name&&(m["idb://".concat(e.name,"/").concat(l.name,"/").concat(d.name)]=new se(-1/0,[[[]]]))}),m["idb://".concat(e.name,"/").concat(l.name,"/")]=m["idb://".concat(e.name,"/").concat(l.name,"/:dels")]=new se(-1/0,[[[]]])}),qe(gt).fire(m),In(m,!0)),e})}function Rn(e){function t(a){return e.next(a)}var n=i(t),r=i(function(a){return e.throw(a)});function i(a){return function(c){var u=a(c),c=u.value;return u.done?c:c&&typeof c.then=="function"?c.then(n,r):N(c)?Promise.all(c).then(n,r):n(c)}}return i(t)()}function Jt(e,t,n){for(var r=N(e)?e.slice():[e],i=0;i<n;++i)r.push(t);return r}var fi={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return b(b({},e),{table:function(t){var n=e.table(t),r=n.schema,i={},a=[];function o(s,m,l){var d=_t(s),y=i[d]=i[d]||[],h=s==null?0:typeof s=="string"?1:s.length,v=0<m,v=b(b({},l),{name:v?"".concat(d,"(virtual-from:").concat(l.name,")"):l.name,lowLevelIndex:l,isVirtual:v,keyTail:m,keyLength:h,extractKey:On(s),unique:!v&&l.unique});return y.push(v),v.isPrimaryKey||a.push(v),1<h&&o(h===2?s[0]:s.slice(0,h-1),m+1,l),y.sort(function(g,w){return g.keyTail-w.keyTail}),v}t=o(r.primaryKey.keyPath,0,r.primaryKey),i[":id"]=[t];for(var u=0,c=r.indexes;u<c.length;u++){var f=c[u];o(f.keyPath,0,f)}function p(s){var m,l=s.query.index;return l.isVirtual?b(b({},s),{query:{index:l.lowLevelIndex,range:(m=s.query.range,l=l.keyTail,{type:m.type===1?2:m.type,lower:Jt(m.lower,m.lowerOpen?e.MAX_KEY:e.MIN_KEY,l),lowerOpen:!0,upper:Jt(m.upper,m.upperOpen?e.MIN_KEY:e.MAX_KEY,l),upperOpen:!0})}}):s}return b(b({},n),{schema:b(b({},r),{primaryKey:t,indexes:a,getIndexByKeyPath:function(s){return(s=i[_t(s)])&&s[0]}}),count:function(s){return n.count(p(s))},query:function(s){return n.query(p(s))},openCursor:function(s){var m=s.query.index,l=m.keyTail,d=m.isVirtual,y=m.keyLength;return d?n.openCursor(p(s)).then(function(v){return v&&h(v)}):n.openCursor(s);function h(v){return Object.create(v,{continue:{value:function(g){g!=null?v.continue(Jt(g,s.reverse?e.MAX_KEY:e.MIN_KEY,l)):s.unique?v.continue(v.key.slice(0,y).concat(s.reverse?e.MIN_KEY:e.MAX_KEY,l)):v.continue()}},continuePrimaryKey:{value:function(g,w){v.continuePrimaryKey(Jt(g,e.MAX_KEY,l),w)}},primaryKey:{get:function(){return v.primaryKey}},key:{get:function(){var g=v.key;return y===1?g[0]:g.slice(0,y)}},value:{get:function(){return v.value}}})}}})}})}};function Mn(e,t,n,r){return n=n||{},r=r||"",I(e).forEach(function(i){var a,o,u;z(t,i)?(a=e[i],o=t[i],typeof a=="object"&&typeof o=="object"&&a&&o?(u=rn(a))!==rn(o)?n[r+i]=t[i]:u==="Object"?Mn(a,o,n,r+i+"."):a!==o&&(n[r+i]=t[i]):a!==o&&(n[r+i]=t[i])):n[r+i]=void 0}),I(t).forEach(function(i){z(e,i)||(n[r+i]=t[i])}),n}function Ln(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var hi={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return b(b({},e),{table:function(t){var n=e.table(t),r=n.schema.primaryKey;return b(b({},n),{mutate:function(i){var a=M.trans,o=a.table(t).hook,u=o.deleting,c=o.creating,f=o.updating;switch(i.type){case"add":if(c.fire===Q)break;return a._promise("readwrite",function(){return p(i)},!0);case"put":if(c.fire===Q&&f.fire===Q)break;return a._promise("readwrite",function(){return p(i)},!0);case"delete":if(u.fire===Q)break;return a._promise("readwrite",function(){return p(i)},!0);case"deleteRange":if(u.fire===Q)break;return a._promise("readwrite",function(){return function s(m,l,d){return n.query({trans:m,values:!1,query:{index:r,range:l},limit:d}).then(function(y){var h=y.result;return p({type:"delete",keys:h,trans:m}).then(function(v){return 0<v.numFailures?Promise.reject(v.failures[0]):h.length<d?{failures:[],numFailures:0,lastResult:void 0}:s(m,b(b({},l),{lower:h[h.length-1],lowerOpen:!0}),d)})})}(i.trans,i.range,1e4)},!0)}return n.mutate(i);function p(s){var m,l,d,y=M.trans,h=s.keys||Ln(r,s);if(!h)throw new Error("Keys missing");return(s=s.type==="add"||s.type==="put"?b(b({},s),{keys:h}):b({},s)).type!=="delete"&&(s.values=K([],s.values)),s.keys&&(s.keys=K([],s.keys)),m=n,d=h,((l=s).type==="add"?Promise.resolve([]):m.getMany({trans:l.trans,keys:d,cache:"immutable"})).then(function(v){var g=h.map(function(w,k){var O,D,P,A=v[k],B={onerror:null,onsuccess:null};return s.type==="delete"?u.fire.call(B,w,A,y):s.type==="add"||A===void 0?(O=c.fire.call(B,w,s.values[k],y),w==null&&O!=null&&(s.keys[k]=w=O,r.outbound||pe(s.values[k],r.keyPath,w))):(O=Mn(A,s.values[k]),(D=f.fire.call(B,O,w,A,y))&&(P=s.values[k],Object.keys(D).forEach(function(S){z(P,S)?P[S]=D[S]:pe(P,S,D[S])}))),B});return n.mutate(s).then(function(w){for(var k=w.failures,O=w.results,D=w.numFailures,w=w.lastResult,P=0;P<h.length;++P){var A=(O||h)[P],B=g[P];A==null?B.onerror&&B.onerror(k[P]):B.onsuccess&&B.onsuccess(s.type==="put"&&v[P]?s.values[P]:A)}return{failures:k,results:O,numFailures:D,lastResult:w}}).catch(function(w){return g.forEach(function(k){return k.onerror&&k.onerror(w)}),Promise.reject(w)})})}}})}})}};function kr(e,t,n){try{if(!t||t.keys.length<e.length)return null;for(var r=[],i=0,a=0;i<t.keys.length&&a<e.length;++i)G(t.keys[i],e[a])===0&&(r.push(n?Re(t.values[i]):t.values[i]),++a);return r.length===e.length?r:null}catch{return null}}var di={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return b(b({},n),{getMany:function(r){if(!r.cache)return n.getMany(r);var i=kr(r.keys,r.trans._cache,r.cache==="clone");return i?j.resolve(i):n.getMany(r).then(function(a){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?Re(a):a},a})},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),n.mutate(r)}})}}}};function xr(e,t){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!t.schema.primaryKey.outbound}function Er(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var pi={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,n=new se(e.MIN_KEY,e.MAX_KEY);return b(b({},e),{transaction:function(r,i,a){if(M.subscr&&i!=="readonly")throw new L.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(M.querier));return e.transaction(r,i,a)},table:function(r){var i=e.table(r),a=i.schema,o=a.primaryKey,s=a.indexes,u=o.extractKey,c=o.outbound,f=o.autoIncrement&&s.filter(function(l){return l.compound&&l.keyPath.includes(o.keyPath)}),p=b(b({},i),{mutate:function(l){function d(S){return S="idb://".concat(t,"/").concat(r,"/").concat(S),w[S]||(w[S]=new se)}var y,h,v,g=l.trans,w=l.mutatedParts||(l.mutatedParts={}),k=d(""),O=d(":dels"),D=l.type,B=l.type==="deleteRange"?[l.range]:l.type==="delete"?[l.keys]:l.values.length<50?[Ln(o,l).filter(function(S){return S}),l.values]:[],P=B[0],A=B[1],B=l.trans._cache;return N(P)?(k.addKeys(P),(B=D==="delete"||P.length===A.length?kr(P,B):null)||O.addKeys(P),(B||A)&&(y=d,h=B,v=A,a.indexes.forEach(function(S){var q=y(S.name||"");function $(U){return U!=null?S.extractKey(U):null}function V(U){return S.multiEntry&&N(U)?U.forEach(function(me){return q.addKey(me)}):q.addKey(U)}(h||v).forEach(function(U,ce){var F=h&&$(h[ce]),ce=v&&$(v[ce]);G(F,ce)!==0&&(F!=null&&V(F),ce!=null&&V(ce))})}))):P?(A={from:(A=P.lower)!==null&&A!==void 0?A:e.MIN_KEY,to:(A=P.upper)!==null&&A!==void 0?A:e.MAX_KEY},O.add(A),k.add(A)):(k.add(n),O.add(n),a.indexes.forEach(function(S){return d(S.name).add(n)})),i.mutate(l).then(function(S){return!P||l.type!=="add"&&l.type!=="put"||(k.addKeys(S.results),f&&f.forEach(function(q){for(var $=l.values.map(function(F){return q.extractKey(F)}),V=q.keyPath.findIndex(function(F){return F===o.keyPath}),U=0,me=S.results.length;U<me;++U)$[U][V]=S.results[U];d(q.name).addKeys($)})),g.mutatedParts=Yt(g.mutatedParts||{},w),S})}}),s=function(d){var y=d.query,d=y.index,y=y.range;return[d,new se((d=y.lower)!==null&&d!==void 0?d:e.MIN_KEY,(y=y.upper)!==null&&y!==void 0?y:e.MAX_KEY)]},m={get:function(l){return[o,new se(l.key)]},getMany:function(l){return[o,new se().addKeys(l.keys)]},count:s,query:s,openCursor:s};return I(m).forEach(function(l){p[l]=function(d){var y=M.subscr,h=!!y,v=xr(M,i)&&Er(l,d)?d.obsSet={}:y;if(h){var g=function(A){return A="idb://".concat(t,"/").concat(r,"/").concat(A),v[A]||(v[A]=new se)},w=g(""),k=g(":dels"),y=m[l](d),h=y[0],y=y[1];if((l==="query"&&h.isPrimaryKey&&!d.values?k:g(h.name||"")).add(y),!h.isPrimaryKey){if(l!=="count"){var O=l==="query"&&c&&d.values&&i.query(b(b({},d),{values:!1}));return i[l].apply(this,arguments).then(function(A){if(l==="query"){if(c&&d.values)return O.then(function($){return $=$.result,w.addKeys($),A});var B=d.values?A.result.map(u):A.result;(d.values?w:k).addKeys(B)}else if(l==="openCursor"){var S=A,q=d.values;return S&&Object.create(S,{key:{get:function(){return k.addKey(S.primaryKey),S.key}},primaryKey:{get:function(){var $=S.primaryKey;return k.addKey($),$}},value:{get:function(){return q&&w.addKey(S.primaryKey),S.value}}})}return A})}k.add(n)}}return i[l].apply(this,arguments)}}),p}})}};function Or(e,t,n){if(n.numFailures===0)return t;if(t.type==="deleteRange")return null;var r=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1;return n.numFailures===r?null:(t=b({},t),N(t.keys)&&(t.keys=t.keys.filter(function(i,a){return!(a in n.failures)})),"values"in t&&N(t.values)&&(t.values=t.values.filter(function(i,a){return!(a in n.failures)})),t)}function Nn(e,t){return n=e,((r=t).lower===void 0||(r.lowerOpen?0<G(n,r.lower):0<=G(n,r.lower)))&&(e=e,(t=t).upper===void 0||(t.upperOpen?G(e,t.upper)<0:G(e,t.upper)<=0));var n,r}function Pr(e,t,m,r,i,a){if(!m||m.length===0)return e;var o=t.query.index,u=o.multiEntry,c=t.query.range,f=r.schema.primaryKey.extractKey,p=o.extractKey,s=(o.lowLevelIndex||o).extractKey,m=m.reduce(function(l,d){var y=l,h=[];if(d.type==="add"||d.type==="put")for(var v=new se,g=d.values.length-1;0<=g;--g){var w,k=d.values[g],O=f(k);v.hasKey(O)||(w=p(k),(u&&N(w)?w.some(function(S){return Nn(S,c)}):Nn(w,c))&&(v.addKey(O),h.push(k)))}switch(d.type){case"add":var D=new se().addKeys(t.values?l.map(function(q){return f(q)}):l),y=l.concat(t.values?h.filter(function(q){return q=f(q),!D.hasKey(q)&&(D.addKey(q),!0)}):h.map(function(q){return f(q)}).filter(function(q){return!D.hasKey(q)&&(D.addKey(q),!0)}));break;case"put":var P=new se().addKeys(d.values.map(function(q){return f(q)}));y=l.filter(function(q){return!P.hasKey(t.values?f(q):q)}).concat(t.values?h:h.map(function(q){return f(q)}));break;case"delete":var A=new se().addKeys(d.keys);y=l.filter(function(q){return!A.hasKey(t.values?f(q):q)});break;case"deleteRange":var B=d.range;y=l.filter(function(q){return!Nn(f(q),B)})}return y},e);return m===e?e:(m.sort(function(l,d){return G(s(l),s(d))||G(f(l),f(d))}),t.limit&&t.limit<1/0&&(m.length>t.limit?m.length=t.limit:e.length===t.limit&&m.length<t.limit&&(i.dirty=!0)),a?Object.freeze(m):m)}function Cr(e,t){return G(e.lower,t.lower)===0&&G(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function yi(e,t){return function(n,r,i,a){if(n===void 0)return r!==void 0?-1:0;if(r===void 0)return 1;if((r=G(n,r))===0){if(i&&a)return 0;if(i)return 1;if(a)return-1}return r}(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=function(n,r,i,a){if(n===void 0)return r!==void 0?1:0;if(r===void 0)return-1;if((r=G(n,r))===0){if(i&&a)return 0;if(i)return-1;if(a)return 1}return r}(e.upper,t.upper,e.upperOpen,t.upperOpen)}function mi(e,t,n,r){e.subscribers.add(n),r.addEventListener("abort",function(){var i,a;e.subscribers.delete(n),e.subscribers.size===0&&(i=e,a=t,setTimeout(function(){i.subscribers.size===0&&Me(a,i)},3e3))})}var vi={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name;return b(b({},e),{transaction:function(n,r,i){var a,o,u=e.transaction(n,r,i);return r==="readwrite"&&(o=(a=new AbortController).signal,i=function(c){return function(){if(a.abort(),r==="readwrite"){for(var f=new Set,p=0,s=n;p<s.length;p++){var m=s[p],l=Ye["idb://".concat(t,"/").concat(m)];if(l){var d=e.table(m),y=l.optimisticOps.filter(function(q){return q.trans===u});if(u._explicit&&c&&u.mutatedParts)for(var h=0,v=Object.values(l.queries.query);h<v.length;h++)for(var g=0,w=(D=v[h]).slice();g<w.length;g++)Tn((P=w[g]).obsSet,u.mutatedParts)&&(Me(D,P),P.subscribers.forEach(function(q){return f.add(q)}));else if(0<y.length){l.optimisticOps=l.optimisticOps.filter(function(q){return q.trans!==u});for(var k=0,O=Object.values(l.queries.query);k<O.length;k++)for(var D,P,A,B=0,S=(D=O[k]).slice();B<S.length;B++)(P=S[B]).res!=null&&u.mutatedParts&&(c&&!P.dirty?(A=Object.isFrozen(P.res),A=Pr(P.res,P.req,y,d,P,A),P.dirty?(Me(D,P),P.subscribers.forEach(function(q){return f.add(q)})):A!==P.res&&(P.res=A,P.promise=j.resolve({result:A}))):(P.dirty&&Me(D,P),P.subscribers.forEach(function(q){return f.add(q)})))}}}f.forEach(function(q){return q()})}}},u.addEventListener("abort",i(!1),{signal:o}),u.addEventListener("error",i(!1),{signal:o}),u.addEventListener("complete",i(!0),{signal:o})),u},table:function(n){var r=e.table(n),i=r.schema.primaryKey;return b(b({},r),{mutate:function(a){var o=M.trans;if(i.outbound||o.db._options.cache==="disabled"||o.explicit||o.idbtrans.mode!=="readwrite")return r.mutate(a);var u=Ye["idb://".concat(t,"/").concat(n)];return u?(o=r.mutate(a),a.type!=="add"&&a.type!=="put"||!(50<=a.values.length||Ln(i,a).some(function(c){return c==null}))?(u.optimisticOps.push(a),a.mutatedParts&&Wt(a.mutatedParts),o.then(function(c){0<c.numFailures&&(Me(u.optimisticOps,a),(c=Or(0,a,c))&&u.optimisticOps.push(c),a.mutatedParts&&Wt(a.mutatedParts))}),o.catch(function(){Me(u.optimisticOps,a),a.mutatedParts&&Wt(a.mutatedParts)})):o.then(function(c){var f=Or(0,b(b({},a),{values:a.values.map(function(p,s){var m;return c.failures[s]?p:(p=(m=i.keyPath)!==null&&m!==void 0&&m.includes(".")?Re(p):b({},p),pe(p,i.keyPath,c.results[s]),p)})}),c);u.optimisticOps.push(f),queueMicrotask(function(){return a.mutatedParts&&Wt(a.mutatedParts)})}),o):r.mutate(a)},query:function(a){if(!xr(M,r)||!Er("query",a))return r.query(a);var o=((f=M.trans)===null||f===void 0?void 0:f.db._options.cache)==="immutable",s=M,u=s.requery,c=s.signal,f=function(d,y,h,v){var g=Ye["idb://".concat(d,"/").concat(y)];if(!g)return[];if(!(y=g.queries[h]))return[null,!1,g,null];var w=y[(v.query?v.query.index.name:null)||""];if(!w)return[null,!1,g,null];switch(h){case"query":var k=w.find(function(O){return O.req.limit===v.limit&&O.req.values===v.values&&Cr(O.req.query.range,v.query.range)});return k?[k,!0,g,w]:[w.find(function(O){return("limit"in O.req?O.req.limit:1/0)>=v.limit&&(!v.values||O.req.values)&&yi(O.req.query.range,v.query.range)}),!1,g,w];case"count":return k=w.find(function(O){return Cr(O.req.query.range,v.query.range)}),[k,!!k,g,w]}}(t,n,"query",a),p=f[0],s=f[1],m=f[2],l=f[3];return p&&s?p.obsSet=a.obsSet:(s=r.query(a).then(function(d){var y=d.result;if(p&&(p.res=y),o){for(var h=0,v=y.length;h<v;++h)Object.freeze(y[h]);Object.freeze(y)}else d.result=Re(y);return d}).catch(function(d){return l&&p&&Me(l,p),Promise.reject(d)}),p={obsSet:a.obsSet,promise:s,subscribers:new Set,type:"query",req:a,dirty:!1},l?l.push(p):(l=[p],(m=m||(Ye["idb://".concat(t,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[a.query.index.name||""]=l)),mi(p,l,u,c),p.promise.then(function(d){return{result:Pr(d.result,a,m?.optimisticOps,r,p,o)}})}})}})}};function Qt(e,t){return new Proxy(e,{get:function(n,r,i){return r==="db"?t:Reflect.get(n,r,i)}})}var Ae=(ne.prototype.version=function(e){if(isNaN(e)||e<.1)throw new L.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new L.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter(function(r){return r._cfg.version===e})[0];return n||(n=new this.Version(e),t.push(n),t.sort(oi),n.stores({}),this._state.autoSchema=!1,n)},ne.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||M.letThrough||this._vip)?e():new j(function(n,r){if(t._state.openComplete)return r(new L.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void r(new L.DatabaseClosed);t.open().catch(Q)}t._state.dbReadyPromise.then(n,r)}).then(e)},ne.prototype.use=function(e){var t=e.stack,n=e.create,r=e.level,i=e.name;return i&&this.unuse({stack:t,name:i}),e=this._middlewares[t]||(this._middlewares[t]=[]),e.push({stack:t,create:n,level:r??10,name:i}),e.sort(function(a,o){return a.level-o.level}),this},ne.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(i){return r?i.create!==r:!!n&&i.name!==n})),this},ne.prototype.open=function(){var e=this;return Ve(De,function(){return li(e)})},ne.prototype._close=function(){var e=this._state,t=rt.indexOf(this);if(0<=t&&rt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new j(function(n){e.dbReadyResolve=n}),e.openCanceller=new j(function(n,r){e.cancelOpen=r}))},ne.prototype.close=function(n){var t=(n===void 0?{disableAutoOpen:!0}:n).disableAutoOpen,n=this._state;t?(n.isBeingOpened&&n.cancelOpen(new L.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new L.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},ne.prototype.delete=function(e){var t=this;e===void 0&&(e={disableAutoOpen:!0});var n=0<arguments.length&&typeof arguments[0]!="object",r=this._state;return new j(function(i,a){function o(){t.close(e);var u=t._deps.indexedDB.deleteDatabase(t.name);u.onsuccess=ee(function(){var c,f,p;c=t._deps,f=t.name,p=c.indexedDB,c=c.IDBKeyRange,Dn(p)||f===qt||Sn(p,c).delete(f).catch(Q),i()}),u.onerror=ke(a),u.onblocked=t._fireOnBlocked}if(n)throw new L.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(o):o()})},ne.prototype.backendDB=function(){return this.idbdb},ne.prototype.isOpen=function(){return this.idbdb!==null},ne.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},ne.prototype.hasFailed=function(){return this._state.dbOpenError!==null},ne.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(ne.prototype,"tables",{get:function(){var e=this;return I(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),ne.prototype.transaction=function(){var e=(function(t,n,r){var i=arguments.length;if(i<2)throw new L.InvalidArgument("Too few arguments");for(var a=new Array(i-1);--i;)a[i-1]=arguments[i];return r=a.pop(),[t,Yn(a),r]}).apply(this,arguments);return this._transaction.apply(this,e)},ne.prototype._transaction=function(e,t,n){var r=this,i=M.trans;i&&i.db===this&&e.indexOf("!")===-1||(i=null);var a,o,u=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");try{if(o=t.map(function(f){if(f=f instanceof r.Table?f.name:f,typeof f!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return f}),e=="r"||e===vn)a=vn;else{if(e!="rw"&&e!=bn)throw new L.InvalidArgument("Invalid transaction mode: "+e);a=bn}if(i){if(i.mode===vn&&a===bn){if(!u)throw new L.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&o.forEach(function(f){if(i&&i.storeNames.indexOf(f)===-1){if(!u)throw new L.SubTransaction("Table "+f+" not included in parent transaction.");i=null}}),u&&i&&!i.active&&(i=null)}}catch(f){return i?i._promise(null,function(p,s){s(f)}):te(f)}var c=(function f(p,s,m,l,d){return j.resolve().then(function(){var y=M.transless||M,h=p._createTransaction(s,m,p._dbSchema,l);if(h.explicit=!0,y={trans:h,transless:y},l)h.idbtrans=l.idbtrans;else try{h.create(),h.idbtrans._explicit=!0,p._state.PR1398_maxLoop=3}catch(w){return w.name===un.InvalidState&&p.isOpen()&&0<--p._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),p.close({disableAutoOpen:!1}),p.open().then(function(){return f(p,s,m,null,d)})):te(w)}var v,g=on(d);return g&&nt(),y=j.follow(function(){var w;(v=d.call(h,h))&&(g?(w=Be.bind(null,null),v.then(w,w)):typeof v.next=="function"&&typeof v.throw=="function"&&(v=Rn(v)))},y),(v&&typeof v.then=="function"?j.resolve(v).then(function(w){return h.active?w:te(new L.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):y.then(function(){return v})).then(function(w){return l&&h._resolve(),h._completion.then(function(){return w})}).catch(function(w){return h._reject(w),te(w)})})}).bind(null,this,a,o,i,n);return i?i._promise(a,c,"lock"):M.trans?Ve(M.transless,function(){return r._whenReady(c)}):this._whenReady(c)},ne.prototype.table=function(e){if(!z(this._allTables,e))throw new L.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},ne);function ne(e,t){var n=this;this._middlewares={},this.verno=0;var r=ne.dependencies;this._options=t=b({addons:ne.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange},r=t.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var i,a,o,u,c,f={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Q,dbReadyPromise:null,cancelOpen:Q,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen};f.dbReadyPromise=new j(function(s){f.dbReadyResolve=s}),f.openCanceller=new j(function(s,m){f.cancelOpen=m}),this._state=f,this.name=e,this.on=yt(this,"populate","blocked","versionchange","close",{ready:[sn,Q]}),this.on.ready.subscribe=Et(this.on.ready.subscribe,function(s){return function(m,l){ne.vip(function(){var d,y=n._state;y.openComplete?(y.dbOpenError||j.resolve().then(m),l&&s(m)):y.onReadyBeingFired?(y.onReadyBeingFired.push(m),l&&s(m)):(s(m),d=n,l||s(function h(){d.on.ready.unsubscribe(m),d.on.ready.unsubscribe(h)}))})}}),this.Collection=(i=this,mt(Zr.prototype,function(v,h){this.db=i;var l=ir,d=null;if(h)try{l=h()}catch(g){d=g}var y=v._ctx,h=y.table,v=h.hook.reading.fire;this._ctx={table:h,index:y.index,isPrimKey:!y.index||h.schema.primKey.keyPath&&y.index===h.schema.primKey.name,range:l,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:d,or:y.or,valueMapper:v!==lt?v:null}})),this.Table=(a=this,mt(sr.prototype,function(s,m,l){this.db=a,this._tx=l,this.name=s,this.schema=m,this.hook=a._allTables[s]?a._allTables[s].hook:yt(null,{creating:[Vr,Q],reading:[zr,lt],updating:[Gr,Q],deleting:[Ur,Q]})})),this.Transaction=(o=this,mt(ni.prototype,function(s,m,l,d,y){var h=this;this.db=o,this.mode=s,this.storeNames=m,this.schema=l,this.chromeTransactionDurability=d,this.idbtrans=null,this.on=yt(this,"complete","error","abort"),this.parent=y||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new j(function(v,g){h._resolve=v,h._reject=g}),this._completion.then(function(){h.active=!1,h.on.complete.fire()},function(v){var g=h.active;return h.active=!1,h.on.error.fire(v),h.parent?h.parent._reject(v):g&&h.idbtrans&&h.idbtrans.abort(),te(v)})})),this.Version=(u=this,mt(ci.prototype,function(s){this.db=u,this._cfg={version:s,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(c=this,mt(dr.prototype,function(s,m,l){if(this.db=c,this._ctx={table:s,index:m===":id"?null:m,or:l},this._cmp=this._ascending=G,this._descending=function(d,y){return G(y,d)},this._max=function(d,y){return 0<G(d,y)?d:y},this._min=function(d,y){return G(d,y)<0?d:y},this._IDBKeyRange=c._deps.IDBKeyRange,!this._IDBKeyRange)throw new L.MissingAPI})),this.on("versionchange",function(s){0<s.newVersion?console.warn("Another connection wants to upgrade database '".concat(n.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(n.name,"'. Closing db now to resume the delete request.")),n.close({disableAutoOpen:!1})}),this.on("blocked",function(s){!s.newVersion||s.newVersion<s.oldVersion?console.warn("Dexie.delete('".concat(n.name,"') was blocked")):console.warn("Upgrade '".concat(n.name,"' blocked by other connection holding version ").concat(s.oldVersion/10))}),this._maxKey=wt(t.IDBKeyRange),this._createTransaction=function(s,m,l,d){return new n.Transaction(s,m,l,n._options.chromeTransactionDurability,d)},this._fireOnBlocked=function(s){n.on("blocked").fire(s),rt.filter(function(m){return m.name===n.name&&m!==n&&!m._state.vcFired}).map(function(m){return m.on("versionchange").fire(s)})},this.use(di),this.use(vi),this.use(pi),this.use(fi),this.use(hi);var p=new Proxy(this,{get:function(s,m,l){if(m==="_vip")return!0;if(m==="table")return function(y){return Qt(n.table(y),p)};var d=Reflect.get(s,m,l);return d instanceof sr?Qt(d,p):m==="tables"?d.map(function(y){return Qt(y,p)}):m==="_createTransaction"?function(){return Qt(d.apply(this,arguments),p)}:d}});this.vip=p,r.forEach(function(s){return s(n)})}var Xt,be=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",bi=(Fn.prototype.subscribe=function(e,t,n){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:n})},Fn.prototype[be]=function(){return this},Fn);function Fn(e){this._subscribe=e}try{Xt={indexedDB:T.indexedDB||T.mozIndexedDB||T.webkitIndexedDB||T.msIndexedDB,IDBKeyRange:T.IDBKeyRange||T.webkitIDBKeyRange}}catch{Xt={indexedDB:null,IDBKeyRange:null}}function Ar(e){var t,n=!1,r=new bi(function(i){var a=on(e),o,u=!1,c={},f={},p={get closed(){return u},unsubscribe:function(){u||(u=!0,o&&o.abort(),s&&qe.storagemutated.unsubscribe(l))}};i.start&&i.start(p);var s=!1,m=function(){return mn(d)},l=function(y){Yt(c,y),Tn(f,c)&&m()},d=function(){var y,h,v;!u&&Xt.indexedDB&&(c={},y={},o&&o.abort(),o=new AbortController,v=function(g){var w=et();try{a&&nt();var k=Ke(e,g);return k=a?k.finally(Be):k}finally{w&&tt()}}(h={subscr:y,signal:o.signal,requery:m,querier:e,trans:null}),Promise.resolve(v).then(function(g){n=!0,t=g,u||h.signal.aborted||(c={},function(w){for(var k in w)if(z(w,k))return;return 1}(f=y)||s||(qe(gt,l),s=!0),mn(function(){return!u&&i.next&&i.next(g)}))},function(g){n=!1,["DatabaseClosedError","AbortError"].includes(g?.name)||u||mn(function(){u||i.error&&i.error(g)})}))};return setTimeout(m,0),p});return r.hasValue=function(){return n},r.getValue=function(){return t},r}var We=Ae;function $n(e){var t=Ie;try{Ie=!0,qe.storagemutated.fire(e),In(e,!0)}finally{Ie=t}}ve(We,b(b({},Pt),{delete:function(e){return new We(e,{addons:[]}).delete()},exists:function(e){return new We(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return t=We.dependencies,n=t.indexedDB,t=t.IDBKeyRange,(Dn(n)?Promise.resolve(n.databases()).then(function(r){return r.map(function(i){return i.name}).filter(function(i){return i!==qt})}):Sn(n,t).toCollection().primaryKeys()).then(e)}catch{return te(new L.MissingAPI)}var t,n},defineClass:function(){return function(e){Y(this,e)}},ignoreTransaction:function(e){return M.trans?Ve(M.transless,e):e()},vip:Kn,async:function(e){return function(){try{var t=Rn(e.apply(this,arguments));return t&&typeof t.then=="function"?t:j.resolve(t)}catch(n){return te(n)}}},spawn:function(e,t,n){try{var r=Rn(e.apply(n,t||[]));return r&&typeof r.then=="function"?r:j.resolve(r)}catch(i){return te(i)}},currentTransaction:{get:function(){return M.trans||null}},waitFor:function(e,t){return t=j.resolve(typeof e=="function"?We.ignoreTransaction(e):e).timeout(t||6e4),M.trans?M.trans.waitFor(t):t},Promise:j,debug:{get:function(){return _e},set:function(e){Xn(e)}},derive:we,extend:Y,props:ve,override:Et,Events:yt,on:qe,liveQuery:Ar,extendObservabilitySet:Yt,getByKeyPath:re,setByKeyPath:pe,delByKeyPath:function(e,t){typeof t=="string"?pe(e,t,void 0):"length"in t&&[].map.call(t,function(n){pe(e,n,void 0)})},shallowClone:Gn,deepClone:Re,getObjectDiff:Mn,cmp:G,asap:H,minKey:-1/0,addons:[],connections:rt,errnames:un,dependencies:Xt,cache:Ye,semVer:"4.0.11",version:"4.0.11".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,2*n)})})),We.maxKey=wt(We.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(qe(gt,function(e){Ie||(e=new CustomEvent(kn,{detail:e}),Ie=!0,dispatchEvent(e),Ie=!1)}),addEventListener(kn,function(e){e=e.detail,Ie||$n(e)}));var ot,Ie=!1,Sr=function(){};return typeof BroadcastChannel<"u"&&((Sr=function(){(ot=new BroadcastChannel(kn)).onmessage=function(e){return e.data&&$n(e.data)}})(),typeof ot.unref=="function"&&ot.unref(),qe(gt,function(e){Ie||ot.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!Ae.disableBfCache&&e.persisted){_e&&console.debug("Dexie: handling persisted pagehide"),ot?.close();for(var t=0,n=rt;t<n.length;t++)n[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!Ae.disableBfCache&&e.persisted&&(_e&&console.debug("Dexie: handling persisted pageshow"),Sr(),$n({all:new se(-1/0,[[]])}))})),j.rejectionMapper=function(e,t){return!e||e instanceof He||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Qn[e.name]?e:(t=new Qn[e.name](t||e.message,e),"stack"in e&&fe(t,"stack",{get:function(){return this.inner.stack}}),t)},Xn(_e),b(Ae,Object.freeze({__proto__:null,Dexie:Ae,liveQuery:Ar,Entity:ar,cmp:G,PropModification:vt,replacePrefix:function(e,t){return new vt({replacePrefix:[e,t]})},add:function(e){return new vt({add:e})},remove:function(e){return new vt({remove:e})},default:Ae,RangeSet:se,mergeRanges:xt,rangesOverlap:br}),{default:Ae}),Ae})}(Zt)),Zt.exports}var xi=ki();const Un=wi(xi),Kr=Symbol.for("Dexie"),en=globalThis[Kr]||(globalThis[Kr]=Un);if(Un.semVer!==en.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Un.semVer} and ${en.semVer}`);const{liveQuery:Ai,mergeRanges:Si,rangesOverlap:Di,RangeSet:Ki,cmp:Bi,Entity:Ti,PropModification:ji,replacePrefix:qi,add:Ii,remove:Ri}=en,ie=new en("library");ie.version(1).stores({books:"++id, autor, titel, spice, bewertung, gelesen, genre, favorit, leseexemplar, verliehen, ist_reihe, aussortiert, geliehen, geliehen_von, ebook"});const Br=x=>x.type==="warning"?window.confirm(x.message)?{response:0}:{response:1}:(x.message&&alert(x.message),{response:0}),Ei=(x,C)=>{const E=[...x];switch(C){case"tit":E.sort((b,K)=>b.titel.localeCompare(K.titel));break;case"gen":E.sort((b,K)=>b.genre.localeCompare(K.genre));break;case"spi-desc":E.sort((b,K)=>K.spice-b.spice);break;case"spi-asc":E.sort((b,K)=>b.spice-K.spice);break;case"bew-desc":E.sort((b,K)=>K.bewertung-b.bewertung);break;case"bew-asc":E.sort((b,K)=>b.bewertung-K.bewertung);break;default:E.sort((b,K)=>{const T=b.autor.split(" ").pop(),I=K.autor.split(" ").pop();return T.localeCompare(I)})}return E},st={async getBook(x){return ie.books.get(x)},async getBooks(x="def",C=void 0){let E=[];switch(x){case"def":case void 0:case null:case"":E=await ie.books.filter(K=>K.aussortiert!==1&&K.geliehen!==1).toArray();break;case"gel":E=await ie.books.where("gelesen").equals(1).toArray();break;case"ung":E=await ie.books.where("gelesen").equals(0).toArray();break;case"fav":E=await ie.books.where("favorit").equals(1).toArray();break;case"exp":E=await ie.books.where("leseexemplar").equals(1).toArray();break;case"ver":E=await ie.books.where("verliehen").equals(1).toArray();break;case"gli":E=await ie.books.where("geliehen").equals(1).toArray();break;case"aus":E=await ie.books.where("aussortiert").equals(1).toArray();break;case"ebo":E=await ie.books.where("ebook").equals(1).toArray();break;default:const b=x.toLowerCase();E=(await ie.books.toArray()).filter(K=>K.autor?.toLowerCase().includes(b)||K.titel?.toLowerCase().includes(b)||K.genre?.toLowerCase().includes(b)||K.anmerkung?.toLowerCase().includes(b)||K.verliehen_an?.toLowerCase().includes(b)||K.geliehen_von?.toLowerCase().includes(b)||K.isbn?.toLowerCase().includes(b));break}return C?Ei(E,C):E},async saveBook(x,C){console.info("Saving book with data:",C);const E={...C};return["gelesen","ist_reihe","favorit","leseexemplar","verliehen","geliehen","ebook","aussortiert"].forEach(b=>E[b]=E[b]==="on"?1:0),["spice","bewertung"].forEach(b=>E[b]=Number(E[b])),E.band=E.band?Number(E.band):-1,E.ist_reihe||(E.band=-1),E.gelesen||(E.beendet_am=""),E.verliehen||(E.verliehen_an=""),E.verliehen||(E.verliehen_an=""),x!=null?await ie.books.update(Number(x),E):await ie.books.add(E),!0},async deleteBook(x){const{response:C}=Br({message:"Möchtest du diesen Eintrag wirklich löschen?",type:"warning"});return C===0?(await ie.books.delete(Number(x)),!0):!1},async clearDatabase(){const{response:x}=Br({message:"Möchtest du wirklich alle Daten in der Datenbank löschen?",type:"warning"});return x===0?(await ie.books.clear(),alert("Database deleted successfully"),!0):!1},async importDatabase(){return new Promise(x=>{const C=document.createElement("input");C.type="file",C.accept=".json",C.onchange=async E=>{const b=E.target.files[0];if(b){const K=new FileReader;K.onload=async T=>{try{const N=JSON.parse(T.target.result).map(({id:Y,...J})=>J);await ie.books.clear(),await ie.books.bulkAdd(N),alert("Data imported successfully"),x(!0)}catch(I){alert(`Error parsing JSON: ${I.message}`),x(!1)}},K.readAsText(b)}},C.click()})},async exportDatabase(){const C=(await ie.books.toArray()).map(({id:T,...I})=>I),E=new Blob([JSON.stringify(C,null,2)],{type:"application/json"}),b=URL.createObjectURL(E),K=document.createElement("a");return K.href=b,K.download="library-export.json",document.body.appendChild(K),K.click(),document.body.removeChild(K),URL.revokeObjectURL(b),!0}};class R{static main=null;static modal=null;static dialog=null;static updateModal(C){console.info("Updating modal with content:",C),R.modal.append(C),R.dialog.showModal()}static closeModal(){if(R.modal)for(;R.modal.firstChild;)R.modal.removeChild(R.modal.firstChild);R.dialog.close()}static currentPage=null;static updateMain(C){if(R.currentPage!==C){if(R.currentPage)for(;R.main.firstChild;)R.main.removeChild(R.main.firstChild);R.currentPage=C,R.currentPage.load()}}static async loadDatabase(C,E){return await st.getBooks(C,E)}static dataChangeFns=[];static addDataChangeFn(C){R.dataChangeFns.push(C)}static callDataChangeFn(){R.dataChangeFns.forEach(C=>C())}static async saveOrCreate(C){C.preventDefault();const E=C.target.closest("form");if(E.checkValidity()===!1){E.reportValidity();return}const b=new FormData;Array.from(E.elements).forEach(T=>{(T.tagName==="INPUT"||T.tagName==="TEXTAREA")&&(T.type==="checkbox"?b.append(T.name,T.checked?"on":""):T.value&&b.append(T.name,T.value))});const K=Object.fromEntries(b.entries());await st.saveBook(E.dataset.id,K),R.callDataChangeFn(),R.closeModal()}static elements={};static createElement(C,E){const b=C.match(/^[a-z\d]+/)[0],K=C.match(/#([\w-]+)/),T=K?K[1]:null;let I=C.match(/\.[\w-]+/g)||[],N=C.match(/{[^}]+}/),Y=C.match(/\[.+\]/);I&&(I=I.map(X=>X.replace(".",""))),N&&(N=N[0].replace(/{|}/g,"")),Y&&(Y=Y[0].slice(1,-1),Y=Y.split("::").reduce((X,z)=>{const[ve,de]=z.split(/=(.+)/);return X[ve]=de.slice(1,-1),X},{})),R.elements[b]||(R.elements[b]=document.createElement(b));const J=R.elements[b].cloneNode(!0);if(N&&(J.textContent=N),T&&(J.id=T),I&&I.forEach(X=>{J.classList.add(X)}),Y&&Object.entries(Y).forEach(([X,z])=>{J.setAttribute(X,z)}),E)if(!Array.isArray(E))J.append(E);else{const X=E.filter(z=>z);J.append(...X)}return J}}const _=R.createElement,Tr=({icon:x,aria:C,background:E})=>_(`button.nav-button.none${E?".background":""}[title="${C}"::aria-label="${C}"]`,[_(`div.ms-within[style="--icon: '${x}';"]`)]),jr=({icon:x,lable:C,title:E})=>_("button.nav-tab.none",[_(`div.ms-within[style="--icon: '${x}';"::title="${E}"]`),_(`span{${C}}`)]),Se=(()=>{const x=Tr({icon:"\\e8b8",aria:"Einstellungen",background:!1}),C=Tr({icon:"\\e145",aria:"Buch hinzufügen",background:!0}),E=jr({icon:"\\f53e",lable:"Bücher",title:"Alle Bücher"}),b=jr({icon:"\\e4fc",lable:"Stats",title:"Statistiken"}),K=()=>{[E,b].forEach(I=>I.classList.remove("active"))};return{HTMLElement:_("nav#nav",[_("div",[x,C]),_("div",[E,b])]),removeActive:K,settings:x,addBook:C,books:E,stats:b}})(),qr=({icon:x,aria:C})=>_(`button.icon-button.none[title="${C}"::aria-label="${C}"]`,[_(`div.ms-within[style="--icon: '${x}';"]`)]),Oi=(()=>{const x=_("div.modal-content-area"),C=qr({aria:"Schließen",icon:"\\e5cd"});C.addEventListener("click",R.closeModal);const E=_("dialog#modal",[_('form[method="dialog"]',[C,x]),x]);return R.modal=x,R.dialog=E,{HTMLElement:E,contentArea:x}})(),ut=({text:x,type:C,submit:E,icon:b}={})=>{const K=String.prototype.concat(".button.none.ms-within",C?`.${C}`:"",b?".icon":""),T=String.prototype.concat(E?'type="submit"':'type="button"',b?`::style="--icon: '${b}';`:"");return _(`button${K}[${T}]`,x)},ue=({label:x,type:C,name:E,checked:b,icon:K}={})=>{let T=x.toLowerCase().replace(" ","-");T=T.replace("ä","ae"),T=T.replace("ö","oe"),T=T.replace("ü","ue");const I=String.prototype.concat(`type="${C}"`,`::name="${E}"`,`${`::style="--icon: '${K}';"`}`,C==="radio"?`::value="${T}"`:""),N=_(`input.ms-within.none#${C}-${T}[${I}]`);return b&&(N.checked=!0),_(`label.chip[for="${C}-${T}"]`,[N,x])},ge=({type:x,label:C,value:E,name:b,required:K,attr:T=""})=>{const I=String.prototype.concat(`type="${x}"`,`::name="${b}"`,'::placeholder=" "',`${K?'::required=""':""}`,`${T}`);if(x==="textarea"){const Y=_(`textarea.none#${b}[name="${b}"${T}]`);return E!=null&&(Y.textContent=E),_(`label[for="${b}"]`,[_(`span{${C}}`),Y])}const N=_(`input.none[${I}]`);return E!=null&&(N.value=E),_(`label[for="${b}"]`,[_(`span{${C}}`),N])},Ir=({data:x,button:C})=>{let E=/^(?=(?:\D*\d){10}(?:(?:\D*\d){3})?$)[\d\-]+$/;E=E.toString();let b=/^.{2,}$/;return b=b.toString(),_(`form.book-data${x?`[data-id="${x.id}"]`:""}`,[_("div.chips-row",[ue({type:"checkbox",label:"Gelesen",name:"gelesen",checked:x?!!x.gelesen:!1,icon:"\\f53e"}),ue({type:"checkbox",label:"Favorit",name:"favorit",checked:x?!!x.favorit:!1,icon:"\\e87d"}),ue({type:"checkbox",label:"Leseexemplar",name:"leseexemplar",checked:x?!!x.leseexemplar:!1,icon:"\\e8b1"}),ue({type:"checkbox",label:"Reihe",name:"ist_reihe",checked:x?!!x.ist_reihe:!1,icon:"\\e02e"}),ue({type:"checkbox",label:"Verliehen",name:"verliehen",checked:x?!!x.verliehen:!1,icon:"\\f808"}),ue({type:"checkbox",label:"Geliehen",name:"geliehen",checked:x?!!x.geliehen:!1,icon:"\\ebcb"}),ue({type:"checkbox",label:"Aussortiert",name:"aussortiert",checked:x?!!x.aussortiert:!1,icon:"\\e14a"}),ue({type:"checkbox",label:"E-Book",name:"ebook",checked:x?!!x.ebook:!1,icon:"\\e30c"})]),ge({type:"text",label:"Titel*",name:"titel",value:x?x.titel:"",required:!0,attr:`::pattern="${b.slice(1,-1)}"`}),ge({type:"text",label:"Autor*",name:"autor",value:x?x.autor:"",required:!0,attr:`::pattern="${b.slice(1,-1)}"`}),_("div.form-row",[ge({type:"text",label:"Genre*",name:"genre",value:x?x.genre:"",required:!0,attr:`::pattern="${b.slice(1,-1)}"`}),ge({type:"date",label:"Beendet am",name:"beendet_am",value:x?x.beendet_am:""})]),_("div.form-row",[ge({type:"number",label:"Spice*",name:"spice",value:x!=null?x.spice:"",required:!0,attr:'::min="0"::max="5"::step="1"'}),ge({type:"number",label:"Bewertung*",name:"bewertung",value:x!=null?x.bewertung:"",required:!0,attr:'::min="0"::max="5"::step="1"'})]),ge({type:"text",label:"Verlag",name:"verlag",value:x?x.verlag:"",attr:`::pattern="${b.slice(1,-1)}"`}),_("div.form-row",[ge({type:"number",label:"Band",name:"band",value:x?x.band===-1?"":x.band:"",attr:'::min="1"::step="1"'}),ge({type:"text",label:"Verliehen an",name:"verliehen_an",value:x?x.verliehen_an:"",attr:`::pattern="${b.slice(1,-1)}"`}),ge({type:"text",label:"Geliehen von",name:"geliehen_von",value:x?x.geliehen_von:"",attr:`::pattern="${b.slice(1,-1)}"`})]),ge({type:"textarea",label:"Anmerkungen",name:"anmerkung",value:x?x.anmerkung:"",attr:'::rows="4"'}),_("div.button-row",C)])},Pi=({label:x,name:C,options:E=[]}={})=>{const b=E.reduce((T,I)=>`${T}-${I.value}`,"dropdown"),K=_(`select.none#${b}[name="${C}"::aria-label="${x}"]`,E.map(T=>_(`option[value="${T.value}"]`,T.label)));return _(`label.chip-dropdown[for="${b}"::title="${x}"]`,[_("div.icon.ms"),K])},Vn=(()=>{const x=()=>{const I=ut({text:"Speichern",type:"filled",icon:"\\e161",submit:!0}),N=ut({text:"Löschen",type:"tonal",icon:"\\e92b"});I.addEventListener("click",J=>{R.saveOrCreate(J)}),N.addEventListener("click",async J=>{J.preventDefault();const{id:X}=J.target.closest("form").dataset;X&&typeof Number(X)=="number"&&await st.deleteBook(X)&&(R.callDataChangeFn(),R.closeModal())});const Y=qr({aria:"Ansehen und bearbeiten",icon:"\\e3c9"});return Y.addEventListener("click",async J=>{const{id:X}=J.target.closest("li").dataset;if(X&&typeof Number(X)=="number"){const z=await st.getBook(+X);z&&R.updateModal(_("div.modal-content",[_("h2","Buch bearbeiten"),Ir({data:z,button:[N,I]})]))}}),Y},C=(I,N=!1)=>_(`li[data-id="${I.id}"]`,[_(`div.ics.ms[data-gelesen="${I.gelesen==1?"true":"false"}"]`),_("div.title-autor",[_(`div.titel${I.favorit?".fav":""}`,[I.titel,_("span.ms-within")]),_("div.autor",I.autor)]),_("div.genre",I.genre),_("div.spice",[...Array.from({length:I.spice},()=>_("span.ms-within.filled")),...Array.from({length:5-I.spice},()=>_("span.ms-within"))]),_(`div.bewertung[data-bewertung="${I.bewertung}"]`,[...Array.from({length:I.bewertung},()=>_("span.ms-within.filled")),...Array.from({length:5-I.bewertung},()=>_("span.ms-within"))]),_("div.edit",N?"":x()),_("hr")]),E=_("ul"),b=I=>{for(;E.firstChild;)E.removeChild(E.firstChild);I.length===0&&E.appendChild(C({id:0,autor:"Keine Daten vorhanden",titel:"Keine Daten vorhanden",genre:"Keine Daten vorhanden",spice:0,bewertung:0,gelesen:!1,favorit:!1},!0)),I.forEach(N=>{E.appendChild(C(N))})},K=Pi({label:"Sortierung",name:"table-sort",options:[{value:"def",label:"Autor"},{value:"tit",label:"Titel"},{value:"gen",label:"Genre"},{value:"spi-desc",label:"Spice - absteigend"},{value:"spi-asc",label:"Spice - aufsteigend"},{value:"bew-desc",label:"Bewertung - absteigend"},{value:"bew-asc",label:"Bewertung - aufsteigend"}]});return{HTMLElement:_("div#books-wrapper",[K,_("div#books",E)]),loadTable:b,selectOrder:K}})(),Ee=(()=>{const x=_('input.none#search-text[type="text"::placeholder="Suchen"]'),C=_('input.ms-within.none#search[type="radio"::name="filter"::value="search"]');return{HTMLElement:_('label.search-chip[for="search"::title="Durchsuche Titel, Autor, ISBN, Genre, Anmerkung und Verliehen an"]',[x,C]),input:x,button:C}})(),Rr=(()=>{const x=ue({type:"radio",label:"Mein Bestand",name:"filter",icon:"\\eb32",checked:!0}),C=ue({type:"radio",label:"Gelesen",name:"filter",icon:"\\f53e"}),E=ue({type:"radio",label:"Ungelesen",name:"filter",icon:"\\e0e0"}),b=ue({type:"radio",label:"Favorit",name:"filter",icon:"\\e87d"}),K=ue({type:"radio",label:"Leseexemplar",name:"filter",icon:"\\e8b1"}),T=ue({type:"radio",label:"Verliehen",name:"filter",icon:"\\e7fd"}),I=ue({type:"radio",label:"Geliehen",name:"filter",icon:"\\ebcb"}),N=ue({type:"radio",label:"Aussortiert",name:"filter",icon:"\\e14a"}),Y=ue({type:"radio",label:"E-Book",name:"filter",icon:"\\e30c"});let J="def",X="def";const z=async(de=null,fe=null)=>{fe!==null&&(J=fe),de!==null&&(X=de);const we=await R.loadDatabase(X,J);Vn.loadTable(we)},ve=()=>{R.main.append(_("form.table-controls",[_("div.chips-row",[x,C,E,b,K,T,I,N,Y,Ee.HTMLElement])]),Vn.HTMLElement),z(),Se.removeActive(),Se.books.classList.add("active")};return x.addEventListener("change",()=>z("def")),C.addEventListener("change",()=>z("gel")),E.addEventListener("change",()=>z("ung")),b.addEventListener("change",()=>z("fav")),K.addEventListener("change",()=>z("exp")),T.addEventListener("change",()=>z("ver")),I.addEventListener("change",()=>z("gli")),N.addEventListener("change",()=>z("aus")),Y.addEventListener("change",()=>z("ebo")),Ee.button.addEventListener("change",()=>{z(Ee.input.value),Ee.button.checked===!1&&(Ee.button.checked=!0)}),Ee.button.addEventListener("click",()=>{Ee.button.checked===!0&&Ee.button.dispatchEvent(new Event("change"))}),Ee.input.addEventListener("keypress",de=>{de.key==="Enter"&&(de.preventDefault(),Ee.button.dispatchEvent(new Event("change")))}),Vn.selectOrder.addEventListener("change",de=>{const fe=de.target.value;z(null,fe)}),Se.books.addEventListener("click",()=>R.updateMain(Rr)),R.addDataChangeFn(z),{load:ve}})(),Ci=(()=>{const x=async()=>{const b=new Date().getFullYear(),K=(H,re)=>{if(H)return H.split("-")[0]===(b-re).toString()};await R.loadDatabase("def","def");const T=(await R.loadDatabase("def")).length,I=(await R.loadDatabase("ung")).length,N=(await R.loadDatabase("gel")).length,Y=(await R.loadDatabase("ver")).length,J=(await R.loadDatabase("gli")).length,X=(await R.loadDatabase("aus")).length,z=(await R.loadDatabase("ebo")).length,ve=(await R.loadDatabase("exp")).length,de=(await R.loadDatabase("fav")).length,fe=(await R.loadDatabase("gel")).filter(H=>H.bewertung===5).length,we=(await R.loadDatabase("gel")).filter(H=>H.spice===5).length,tn=(await R.loadDatabase("gel")).filter(H=>K(H.beendet_am,0)).length,nn=(await R.loadDatabase("gel")).filter(H=>K(H.beendet_am,1)).length,Qe=(await R.loadDatabase("gel")).filter(H=>K(H.beendet_am,2)).length,Et=(await R.loadDatabase("gel")).reduce((H,re)=>(Object.prototype.hasOwnProperty.call(H,re.genre)?H[re.genre]+=1:H[re.genre]=1,H),{}),Oe=Object.entries(Et).sort((H,re)=>re[1]-H[1]).slice(0,3).reduce((H,re)=>(H.push(re[0]),H),[]);return{booksNumber:T,ungelesen:I,gelesen:N,verliehen:Y,geliehen:J,aussortiert:X,ebook:z,leseexemplar:ve,favoriten:de,fuenfSterne:fe,fuenfSpice:we,gelesenDiesesJahr:tn,gelesenLetztesJahr:nn,gelesenVorLetztemJahr:Qe,genre1:Oe[0],genre2:Oe[1],genre3:Oe[2]}},C=b=>_("div.stats",_("table.stats",[_("tr",[_("td","Anzahl der Bücher:"),_("td",b.booksNumber||"0")]),_("tr",[_("td","Anzahl der ungelesenen Bücher:"),_("td",b.ungelesen||"0")]),_("tr",[_("td","Anzahl der gelesenen Bücher:"),_("td",b.gelesen||"0")]),_("tr",[_("td","Prozentsatz der ungelesen Bücher:"),_("td",`${(b.ungelesen/b.booksNumber*100||0).toFixed(1)}%`)]),_("tr",[_("td","Anzahl der verliehenen Bücher:"),_("td",b.verliehen||"0")]),_("tr",[_("td","Anzahl der geliehenen Bücher:"),_("td",b.geliehen||"0")]),_("tr",[_("td","Anzahl der aussortierten Bücher:"),_("td",b.aussortiert||"0")]),_("tr",[_("td","Anzahl der E-Books:"),_("td",b.ebook||"0")]),_("tr",[_("td","Anzahl der Leseexemplare:"),_("td",b.leseexemplar||"0")]),_("tr",[_("td","Anzahl der Favoriten:"),_("td",b.favoriten||"0")]),_("tr",[_("td","Anzahl der 5-Sterne-Bewertungen:"),_("td",b.fuenfSterne||"0")]),_("tr",[_("td","Anzahl der 5-Spice-Bewertungen:"),_("td",b.fuenfSpice||"0")]),_("tr",[_("td","Gelesene Bücher dieses Jahr:"),_("td",b.gelesenDiesesJahr||"0")]),_("tr",[_("td","Gelesene Bücher letztes Jahr:"),_("td",b.gelesenLetztesJahr||"0")]),_("tr",[_("td","Gelesene Bücher vorletztes Jahr:"),_("td",b.gelesenVorLetztemJahr||"0")]),_("tr",[_("td","Häufigste Genre:"),_("td",b.genre1||"Keine Daten")]),_("tr",[_("td","Zweit häufigste Genre:"),_("td",b.genre2||"Keine Daten")]),_("tr",[_("td","Dritt häufigste Genre:"),_("td",b.genre3||"Keine Daten")])])),E=async()=>{R.main.append(C(await x())),Se.removeActive(),Se.stats.classList.add("active")};return Se.stats.addEventListener("click",()=>R.updateMain(Ci)),{load:E}})();(()=>{const x=ut({text:"Importieren",type:"tonal"}),C=ut({text:"Exportieren",type:"filled"});ut({text:"Löschen",type:"tonal"}),x.addEventListener("click",()=>{st.importDatabase().then(R.callDataChangeFn)}),C.addEventListener("click",st.exportDatabase);const E=_("div.modal-content",[_("h2","Einstellungen"),_("h3","Datenbank"),_("p","Diese Einstellungen sind mit großer Vorsicht zu behandeln!"),_("div.button-row",[C,x]),_("h3","Sortierung"),_("p",'Die normale Reihenfolge der Bücher ist nach Nachnamen des Autors. Gibt es zwei Nachnamen, wird der letzte genommen. Besteht der Nachname aus zwei Teilen, sollten die Teile mit einem Bindestrich zusammengefügt werden. Beispiel: "Le Guin" wird zu "Le-Guin".')]);Se.settings.addEventListener("click",()=>R.updateModal(E))})();(()=>{const x=ut({text:"Hinzufügen",type:"filled",icon:"\\e145",submit:!0});x.addEventListener("click",R.saveOrCreate);const C=()=>{const E=Ir({data:null,button:x});return _("div.modal-content",[_("h2","Buch hinzufügen"),E])};Se.addBook.addEventListener("click",()=>R.updateModal(C()))})();R.main=_("main");R.updateMain(Rr);document.body.append(Se.HTMLElement,_("div.main-wrapper",R.main),Oi.HTMLElement);
